{"id":"bd-log1","title":"Add DIY minimal logging to agent-relay daemon","description":"Implement a lightweight ~20-line logging approach for the agent-relay daemon. No external library needed.\n\nRequirements:\n- log_info(), log_warn(), log_error(), log_debug() functions\n- JSON output format for easy parsing with jq\n- Configurable via LOG_FILE and DEBUG env vars\n- Log daemon startup/shutdown\n- Log errors (delivery failures, connection issues)\n- Debug-only message delivery logging\n- Minimal performance impact (sub-5ms system)\n\nImplementation:\n```bash\n_log() {\n    local level=\"$1\" msg=\"$2\"\n    local ts=$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")\n    printf '{\"ts\":\"%s\",\"level\":\"%s\",\"msg\":\"%s\"}\\n' \"$ts\" \"$level\" \"$msg\" >> \"$LOG_FILE\"\n    [[ \"$LOG_STDOUT\" == \"1\" ]] && echo \"[$level] $msg\"\n}\n\nlog_info()  { _log \"INFO\"  \"$1\"; }\nlog_warn()  { _log \"WARN\"  \"$1\"; }\nlog_error() { _log \"ERROR\" \"$1\"; }\nlog_debug() { [[ \"${DEBUG:-0}\" == \"1\" ]] && _log \"DEBUG\" \"$1\"; }\n```\n\nFiles modified:\n- src/utils/logger.ts (new file - TypeScript implementation)\n- src/daemon/server.ts (integrated logging)\n- src/utils/index.ts (exported logger)","priority":50,"status":"closed","created_at":"2026-01-01T07:40:00Z","closed_at":"2026-01-01T07:46:00Z","closed_reason":"Implemented TypeScript version with JSON output, configurable log levels, file logging support","tags":["logging","infrastructure","low-priority"]}
{"id":"bd-custom-cmd1","title":"Custom Relay Commands - Implementation Approach Decision","description":"Allow users to define custom command patterns that trigger code execution when agents output them.\n\nSpec: docs/proposals/custom-commands.md\n\nDecision Required: Which implementation approach?\n\n| Option | Complexity | Flexibility | Time to MVP |\n|--------|------------|-------------|-------------|\n| A. Script Directory | Low | Low | 1-2 days |\n| B. YAML Config | Medium | High | 3-5 days |\n| C. TypeScript | High | Very High | 1-2 weeks |\n| D. Hybrid (Aâ†’B) | Lowâ†’Medium | Progressive | 2 days + iterate |\n\nRecommendation: Option D (Hybrid)\n- Ship script directory first (works immediately)\n- Add YAML config based on user feedback\n- TypeScript handlers as future enhancement\n\nUse Cases:\n- DevOps: ->deploy:staging, ->rollback:prod\n- Integrations: ->jira:create, ->slack:#team\n- Testing: ->test:unit, ->lint:fix\n- Agent Coordination: ->assign:Alice, ->handoff:Bob","priority":70,"status":"open","created_at":"2026-01-04T10:00:00Z","tags":["feature","extensibility","decision-required"]}
{"id":"bd-mobile-cli","title":"Mobile App: CLI Wrapper for Agent Relay","description":"Create a CLI wrapper that enables mobile app control of AI coding sessions.\n\n## Inspiration (Happy CLI)\nHappy wraps Claude/Codex with:\n1. Child process spawning with custom hooks\n2. MCP server for permission interception\n3. WebSocket sync to mobile clients\n4. Local â†” Remote mode switching\n\n## Architecture\n```\nrelay-mobile (CLI) â†’ agent-relay daemon â†’ Mobile App (WebSocket)\n```\n\n## Key Components\n\n### 1. Session Launcher\n- Wrap `claude` command with hooks\n- Inject MCP server for permission forwarding\n- Generate QR code for mobile pairing\n- Track session metadata (cwd, git status)\n\n### 2. Mode Controller\n- Local: Full terminal control\n- Remote: Mobile controls, desktop read-only\n- Instant keypress switching\n- State preserved across mode changes\n\n### 3. Permission Bridge\n- Intercept Claude permission requests\n- Forward to mobile via agent-relay\n- Return approval/denial\n- Timeout + default behavior\n\n### 4. Session Sync\n- Real-time message streaming\n- File change notifications\n- Git status updates\n- Terminal output mirroring\n\n## Files to Create\n- src/mobile/index.ts\n- src/mobile/launcher.ts\n- src/mobile/mode.ts\n- src/mobile/permissions.ts\n- src/mobile/sync.ts\n- bin/relay-mobile\n\n## Dependencies\n- Existing agent-relay daemon\n- qrcode-terminal\n- @anthropic-ai/claude-code SDK (optional)","priority":90,"status":"open","created_at":"2026-01-04T19:00:00Z","tags":["mobile","cli","infrastructure","epic"]}
{"id":"bd-mobile-e2e","title":"Mobile App: End-to-End Encryption","description":"Implement E2E encryption for mobile sync - server sees only encrypted blobs.\n\n## Why Critical\n- Developers' code is sensitive IP\n- Builds trust for enterprise adoption\n- Enables self-hosted deployments\n- Differentiator vs closed alternatives\n\n## Happy's Approach\n- tweetnacl + libsodium\n- AES for message content\n- HMAC-SHA512 for integrity\n- Key derivation from credentials (never stored on server)\n- Server stores only encrypted blobs\n\n## Our Implementation\n\n### Key Management\n```typescript\ninterface KeyPair {\n  publicKey: Uint8Array;  // Shared with server for routing\n  secretKey: Uint8Array;  // Never leaves device\n}\n```\n\n### Encryption Flow\n1. Client generates keypair on first launch\n2. Messages encrypted with recipient's public key\n3. Server routes based on public key, cannot decrypt\n4. Recipient decrypts with secret key\n\n### Libraries\n- libsodium-wrappers (better maintained than tweetnacl)\n- Use sealed boxes for anonymous encryption\n- Use secretbox for symmetric encryption\n\n## Files to Create\n- src/mobile/crypto/keypair.ts\n- src/mobile/crypto/encrypt.ts\n- src/mobile/crypto/decrypt.ts\n- src/mobile/crypto/keystore.ts (secure storage)\n\n## Security Requirements\n- Keys stored in secure enclave (iOS Keychain, Android Keystore)\n- No plaintext in logs\n- Wipe keys on logout\n- Support key rotation","priority":85,"status":"open","created_at":"2026-01-04T19:00:00Z","tags":["mobile","security","encryption","critical"]}
{"id":"bd-mobile-push","title":"Mobile App: Push Notifications for Agent Events","description":"Push notifications when AI agents need attention.\n\n## Key Events\n1. **Permission Required** - Agent wants to run command/edit file\n2. **Error Occurred** - Build failed, test failed, exception\n3. **Task Complete** - Long-running task finished\n4. **Agent Spawned** - New agent started in your session\n5. **Message Received** - Another agent sent you a message\n\n## Architecture\n```\nAgent Event â†’ Daemon â†’ Push Server â†’ APNs/FCM â†’ Mobile\n```\n\n## Implementation\n\n### Server Side (daemon extension)\n```typescript\ninterface PushEvent {\n  type: 'permission' | 'error' | 'complete' | 'spawn' | 'message';\n  sessionId: string;\n  title: string;\n  body: string;\n  data: Record<string, unknown>;\n  priority: 'high' | 'normal';\n}\n```\n\n### Mobile Side\n- Register device token on login\n- Handle notification tap â†’ deep link to session\n- Background fetch for silent updates\n- Rich notifications with actions (Approve/Deny)\n\n### Push Providers\n- APNs for iOS (via expo-notifications or direct)\n- FCM for Android\n- Web Push for browser clients\n\n## Files to Create\n- src/daemon/push/index.ts\n- src/daemon/push/apns.ts\n- src/daemon/push/fcm.ts\n- src/daemon/push/events.ts\n\n## Dependencies\n- expo-notifications (mobile)\n- apn or @parse/node-apn (server)\n- firebase-admin (server, FCM)","priority":80,"status":"open","created_at":"2026-01-04T19:00:00Z","tags":["mobile","notifications","infrastructure"]}
{"id":"bd-mobile-multiagent","title":"Mobile App: Multi-Agent Dashboard View","description":"Our competitive advantage: See ALL your agents, not just one session.\n\n## Happy's Limitation\nHappy shows one Claude session. We can show your entire agent workforce.\n\n## Dashboard Features\n\n### Agent Grid View\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  ğŸŸ¢ Lead    â”‚  ğŸŸ¡ Alice   â”‚  ğŸŸ¢ Bob     â”‚\nâ”‚  Planning   â”‚  Building   â”‚  Testing    â”‚\nâ”‚  auth-feat  â”‚  /api/user  â”‚  unit tests â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Per-Agent Detail\n- Current task / status\n- Recent messages\n- Pending approvals\n- Token usage\n- Active files\n\n### Quick Actions\n- Tap to view full session\n- Swipe to send message\n- Long-press for agent menu\n- Pull-to-refresh status\n\n## Data Model\n```typescript\ninterface AgentStatus {\n  id: string;\n  name: string;\n  status: 'active' | 'idle' | 'blocked' | 'offline';\n  currentTask?: string;\n  lastActivity: Date;\n  pendingApprovals: number;\n  tokenUsage: { input: number; output: number };\n}\n```\n\n## Integration Points\n- Existing agent-relay WebSocket\n- Dashboard API endpoints\n- Presence system\n\n## Files to Create (Mobile)\n- screens/AgentDashboard.tsx\n- components/AgentCard.tsx\n- components/AgentGrid.tsx\n- hooks/useAgentStatuses.ts","priority":85,"status":"open","created_at":"2026-01-04T19:00:00Z","tags":["mobile","dashboard","multiagent","differentiator"]}
{"id":"bd-mobile-approval","title":"Mobile App: Approval Queue & Batch Actions","description":"Efficiently manage permission requests from mobile.\n\n## Problem\nAI agents frequently need approval for:\n- File edits\n- Command execution\n- External API calls\n- Git operations\n\n## Solution: Approval Queue\n\n### Queue View\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ ğŸ”” Pending Approvals (5)               â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ âœï¸ Edit src/auth/login.ts             â”‚\nâ”‚    Alice â€¢ 2m ago                      â”‚\nâ”‚    [Approve] [Deny] [View Diff]        â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ âš¡ Run npm test                        â”‚\nâ”‚    Bob â€¢ 5m ago                        â”‚\nâ”‚    [Approve] [Deny] [View Command]     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Batch Actions\n- Select multiple approvals\n- \"Approve All\" for trusted agents\n- \"Approve Similar\" (all file edits, all tests)\n- Auto-approve rules (per agent, per type)\n\n### Smart Defaults\n- Remember past decisions\n- Suggest based on file/command pattern\n- Timeout with configurable default\n\n## Data Model\n```typescript\ninterface ApprovalRequest {\n  id: string;\n  agentId: string;\n  agentName: string;\n  type: 'file_edit' | 'command' | 'api_call' | 'git';\n  description: string;\n  details: FileEditDetails | CommandDetails | ...;\n  createdAt: Date;\n  expiresAt: Date;\n  status: 'pending' | 'approved' | 'denied' | 'expired';\n}\n```\n\n## Files to Create\n- screens/ApprovalQueue.tsx\n- components/ApprovalCard.tsx\n- components/DiffViewer.tsx\n- hooks/useApprovals.ts\n- api/approvals.ts","priority":80,"status":"open","created_at":"2026-01-04T19:00:00Z","tags":["mobile","permissions","ux"]}
{"id":"bd-mobile-sync","title":"Mobile App: Real-Time Session Sync Engine","description":"Robust sync engine for mobile â†” desktop session state.\n\n## Challenges\n- Unreliable mobile connectivity\n- Large message volumes\n- State conflicts\n- Battery efficiency\n\n## Happy's Approach\n- 86KB sync.ts (!) - complex problem\n- Socket.io for transport\n- Optimistic updates\n- Conflict resolution\n\n## Our Architecture\n\n### Transport Layer\n```typescript\nclass SyncSocket {\n  private socket: Socket;\n  private reconnectAttempts: number;\n  \n  connect(sessionId: string): void;\n  disconnect(): void;\n  send(message: SyncMessage): void;\n  onMessage(handler: (msg: SyncMessage) => void): void;\n}\n```\n\n### Message Types\n```typescript\ntype SyncMessage =\n  | { type: 'full_state'; state: SessionState }\n  | { type: 'delta'; changes: Change[] }\n  | { type: 'ack'; messageId: string }\n  | { type: 'conflict'; resolution: 'local' | 'remote' };\n```\n\n### Offline Support\n- Queue messages when offline\n- Sync on reconnect\n- Local-first with server reconciliation\n- Persist queue to AsyncStorage/MMKV\n\n### Optimization\n- Delta compression for large states\n- Debounce rapid updates\n- Background sync limits\n- Selective sync (don't sync everything)\n\n## Files to Create\n- src/mobile/sync/SyncSocket.ts\n- src/mobile/sync/SyncEngine.ts\n- src/mobile/sync/OfflineQueue.ts\n- src/mobile/sync/ConflictResolver.ts\n- src/mobile/sync/DeltaCompressor.ts","priority":75,"status":"open","created_at":"2026-01-04T19:00:00Z","tags":["mobile","sync","infrastructure","complex"]}
{"id":"bd-mobile-voice","title":"Mobile App: Voice Interaction (Future)","description":"Voice control for hands-free agent interaction.\n\n## Why Voice on Mobile?\n- Use while commuting/walking\n- Accessibility\n- Faster than typing on phone\n- Natural interaction model\n\n## Happy's Stack\n- LiveKit for WebRTC infrastructure\n- ElevenLabs for TTS\n- Platform-specific implementations\n\n## Our Approach (Future)\n\n### Phase 1: Voice-to-Text Input\n- Use native speech recognition (iOS/Android)\n- Send transcribed text as messages\n- No server-side voice processing\n\n### Phase 2: Text-to-Speech Output\n- Read agent responses aloud\n- Use native TTS or ElevenLabs\n- Configurable voice/speed\n\n### Phase 3: Real-Time Conversation\n- LiveKit or Daily.co for WebRTC\n- Claude voice mode integration (when available)\n- Push-to-talk or wake word\n\n## Technical Considerations\n- Battery impact of always-on audio\n- Background audio handling\n- Bluetooth headset support\n- Noise cancellation\n\n## Priority: Low\nVoice is a differentiator but complex. Focus on core mobile features first.","priority":40,"status":"open","created_at":"2026-01-04T19:00:00Z","tags":["mobile","voice","future","nice-to-have"]}
{"id":"bd-mobile-trajectory","title":"Mobile App: Trajectory Viewer","description":"Review agent decision history on mobile.\n\n## Value Prop\nUnderstand WHY an agent made decisions, not just WHAT it did.\n\n## Features\n\n### Trajectory Timeline\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ ğŸ“ Auth Implementation                 â”‚\nâ”‚    Alice â€¢ Started 2h ago              â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ âœ… Decision: JWT over sessions         â”‚\nâ”‚    Reasoning: Stateless scaling        â”‚\nâ”‚    12:34 PM                            â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ âœ… Decision: bcrypt for passwords      â”‚\nâ”‚    Reasoning: Industry standard        â”‚\nâ”‚    12:45 PM                            â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ ğŸ”„ In Progress: Token refresh          â”‚\nâ”‚    Current file: src/auth/refresh.ts   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Search & Filter\n- Search past trajectories\n- Filter by agent, date, confidence\n- Find similar past decisions\n\n### Integration\n- Use existing trail system\n- Pull from .trajectories directory\n- Real-time updates via sync\n\n## Files to Create\n- screens/TrajectoryViewer.tsx\n- components/TrajectoryTimeline.tsx\n- components/DecisionCard.tsx\n- hooks/useTrajectories.ts","priority":60,"status":"open","created_at":"2026-01-04T19:00:00Z","tags":["mobile","trajectories","differentiator"]}
{"id":"bd-mobile-cost","title":"Mobile App: Cost & Usage Dashboard","description":"Track API costs in real-time from mobile.\n\n## Features\n\n### Usage Overview\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ ğŸ’° Today's Usage                       â”‚\nâ”‚    $12.34 / $50 budget                 â”‚\nâ”‚    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 25%               â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ By Agent                               â”‚\nâ”‚    Lead:  $4.50 (36%)                  â”‚\nâ”‚    Alice: $3.20 (26%)                  â”‚\nâ”‚    Bob:   $4.64 (38%)                  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ By Model                               â”‚\nâ”‚    Opus:   $8.00                       â”‚\nâ”‚    Sonnet: $4.34                       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Alerts\n- Push notification at 50%, 80%, 100% budget\n- Per-agent cost warnings\n- Unusual usage patterns\n\n### History\n- Daily/weekly/monthly charts\n- Cost by project\n- Export for expense reports\n\n## Data Source\n- Token counts from agent-relay\n- Price calculation based on model\n- Aggregation in daemon\n\n## Files to Create\n- screens/CostDashboard.tsx\n- components/UsageChart.tsx\n- components/BudgetBar.tsx\n- hooks/useUsageStats.ts","priority":55,"status":"open","created_at":"2026-01-04T19:00:00Z","tags":["mobile","cost","analytics"]}
{"id":"bd-mobile-app","title":"Mobile App: React Native Expo Project Setup","description":"Initialize the mobile app project with proper architecture.\n\n## Tech Stack (Matching Happy)\n- React Native + Expo SDK 54\n- Expo Router v5 (file-based routing)\n- TypeScript strict mode\n- Zustand for state management\n- Socket.io-client for realtime\n- NativeWind or Unistyles for styling\n- MMKV for fast storage\n\n## Project Structure\n```\napps/mobile/\nâ”œâ”€â”€ app/                    # Expo Router screens\nâ”‚   â”œâ”€â”€ (auth)/            # Auth flow\nâ”‚   â”œâ”€â”€ (tabs)/            # Main tab navigator\nâ”‚   â”‚   â”œâ”€â”€ dashboard.tsx  # Agent dashboard\nâ”‚   â”‚   â”œâ”€â”€ approvals.tsx  # Approval queue\nâ”‚   â”‚   â””â”€â”€ settings.tsx   # Settings\nâ”‚   â”œâ”€â”€ session/[id].tsx   # Session detail\nâ”‚   â””â”€â”€ _layout.tsx        # Root layout\nâ”œâ”€â”€ components/            # Shared components\nâ”œâ”€â”€ hooks/                 # Custom hooks\nâ”œâ”€â”€ stores/                # Zustand stores\nâ”œâ”€â”€ api/                   # API client\nâ”œâ”€â”€ crypto/                # Encryption\nâ””â”€â”€ utils/                 # Utilities\n```\n\n## Configuration\n- app.config.js for Expo config\n- eas.json for builds\n- Path aliases (@/ â†’ ./)\n\n## Initial Setup Tasks\n1. npx create-expo-app@latest\n2. Configure TypeScript strict\n3. Add Expo Router\n4. Set up state management\n5. Configure styling solution\n6. Add socket.io-client\n7. Set up testing (Jest + RTL)\n\n## CI/CD\n- EAS Build for iOS/Android\n- EAS Submit for store deployment\n- OTA updates via EAS Update","priority":95,"status":"open","created_at":"2026-01-04T19:00:00Z","tags":["mobile","setup","infrastructure","epic"]}
