{"id":"agent-relay-0bn","title":"Dashboard doesn't show real-time connection status","description":"Dashboard shows agent status from messages but doesn't show live connection status (connected/disconnected). The daemon tracks this in agents.json but dashboard could show online/offline indicators with last-seen timestamps.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-20T00:18:04.647965+01:00","updated_at":"2025-12-22T22:07:18.220968+01:00","closed_at":"2025-12-22T22:07:18.220968+01:00"}
{"id":"agent-relay-0g4","title":"Add agent portability (export/import)","description":"Enable exporting agent state and history as portable packages (like AI Maestro's .zip export). Include conversation history, learned patterns, configuration. Enables agent migration between machines and backup/restore workflows.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-23T17:04:41.847187+01:00","updated_at":"2025-12-23T17:04:41.847187+01:00"}
{"id":"agent-relay-0uh","title":"Add session discovery for better status output","description":"Auto-discover relay sessions via 'tmux list-sessions'. Filter to relay-* sessions and extract agent names. Enhance 'agent-relay status' command output. See docs/TMUX_IMPROVEMENTS.md for implementation details.","status":"closed","priority":2,"issue_type":"feature","assignee":"LeadDev","created_at":"2025-12-20T21:28:49.058578+01:00","updated_at":"2025-12-20T21:36:23.10406+01:00","closed_at":"2025-12-20T21:36:23.10406+01:00"}
{"id":"agent-relay-1ek","title":"Add agent registry for persistence across restarts","description":"Store agent metadata in persistent registry (agents.json): id, name, cli, workingDirectory, firstSeen, lastSeen, messagesSent, messagesReceived. Enables agent history and stats. See docs/TMUX_IMPROVEMENTS.md for implementation details.","notes":"No progress today; agent registry idea remains open. Consider aligning with Swarm Mail 'agents' projection + last_active tracking.","status":"closed","priority":3,"issue_type":"feature","assignee":"Implementer","created_at":"2025-12-20T21:28:50.235444+01:00","updated_at":"2025-12-22T17:08:50.330703+01:00","closed_at":"2025-12-22T17:08:50.330703+01:00"}
{"id":"agent-relay-1ie","title":"Fix Gemini CLI message injection and handling","description":"Investigate and fix issues where Gemini agent messages are not being correctly picked up by the tmux-wrapper. Ensure the special printf injection path is working and that standard LLM output is captured correctly.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T12:11:57.073531+01:00","updated_at":"2025-12-22T12:17:27.434451+01:00","closed_at":"2025-12-22T12:17:27.434456+01:00"}
{"id":"agent-relay-1le","title":"Agent name truncated in tmux pane/status bar","description":"Agent name gets cut off in tmux display. May need to adjust tmux status bar width or session naming convention. Check: tmux status-left-length, session name format (relay-{name}-{pid}).","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-20T22:11:15.795453+01:00","updated_at":"2025-12-22T14:55:02.472816+01:00","closed_at":"2025-12-22T14:55:02.472818+01:00"}
{"id":"agent-relay-1t7","title":"Project name display in bridge header","description":"Show selected project name in the bridge interface header for clarity","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T11:47:39.531513+01:00","updated_at":"2025-12-24T11:59:16.98688+01:00","closed_at":"2025-12-24T11:59:16.98688+01:00"}
{"id":"agent-relay-290","title":"Interface parity: bridge vs dashboard features","description":"Audit and synchronize features between bridge and dashboard interfaces to ensure feature parity","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T11:47:58.911802+01:00","updated_at":"2025-12-24T12:01:06.6157+01:00","closed_at":"2025-12-24T12:01:06.6157+01:00"}
{"id":"agent-relay-291","title":"Add auto-update notification for new versions","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T20:47:26.14765-05:00","updated_at":"2025-12-28T20:55:46.186959-05:00","closed_at":"2025-12-28T20:55:46.186959-05:00"}
{"id":"agent-relay-292","title":"Unified project navigation: nested agents under projects in sidebar","description":"Instead of bridge being a different interface, show projects in the main dashboard with agents nested under them in the sidebar.\n\nKey features:\n1. Projects shown in sidebar with agents nested underneath\n2. Bridged projects navigable via command palette and sidebar\n3. Bridge-level coordinator agent can communicate with project Leads\n4. Primary agent can distribute work to project-specific leads\n5. Easy switching between all bridged projects from one dashboard\n\nThis unifies the bridge experience into the main dashboard UI rather than a separate interface.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-29T06:00:28.688108218Z","updated_at":"2025-12-29T06:11:56.254163858Z","closed_at":"2025-12-29T06:11:56.254163858Z"}
{"id":"agent-relay-293","title":"Fix agent-relay release CLI command","description":"The 'agent-relay release' CLI fails with 'open terminal failed: not a terminal' when called from another agent. Spawned agents cannot be released via CLI. Need to fix terminal detection or use API directly.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T06:42:00.654052127Z","updated_at":"2025-12-29T12:17:37.759791-05:00","closed_at":"2025-12-29T12:17:36.505676-05:00"}
{"id":"agent-relay-294","title":"Increase ACK timeout from 2s to 5-10s","description":"Message ACK timeout is only 2s (src/daemon/router.ts:43). Too short for agents doing heavy processing, causing 'Waiting for X ACK' loops. Increase to 5-10s.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-29T06:42:03.047914487Z","updated_at":"2025-12-29T16:11:27.097185-05:00","closed_at":"2025-12-29T15:52:05.318521-05:00"}
{"id":"agent-relay-295","title":"Add heartbeat exemption during active processing","description":"Heartbeat timeout (30s) can kill agents during long tool calls. Add exemption or async heartbeat handling during active processing state.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-29T06:42:04.854217445Z","updated_at":"2025-12-29T06:42:04.854217445Z"}
{"id":"agent-relay-296","title":"Fix scroll to latest message on incoming message","description":"The dashboard should auto-scroll to show the latest message when new messages arrive. Current logic has issues - messages may not be visible without manual scrolling.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-29T14:56:37.61964278Z","updated_at":"2025-12-29T15:36:18.718745-05:00","closed_at":"2025-12-29T15:32:33.242914-05:00"}
{"id":"agent-relay-297","title":"Cross-project thread syntax support","description":"Extend parser to support [thread:projectId:threadId] syntax for threads spanning bridged projects. Adds threadProject field to ParsedCommand.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-29T15:45:13.172148225Z","updated_at":"2025-12-29T15:51:28.157935691Z","closed_at":"2025-12-29T15:51:28.157935691Z"}
{"id":"agent-relay-298","title":"Spawn workflow: wait for ACK before sending instructions","description":"Current workflow sends spawn + instructions together, but spawned agent may not be ready. New workflow should: 1. Spawn agent 2. Wait for agent to connect and ACK 3. Then send initial instructions. This ensures reliable instruction delivery to spawned agents.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T15:26:45.376721-05:00","updated_at":"2025-12-29T15:37:09.847741-05:00","closed_at":"2025-12-29T15:37:02.37033-05:00"}
{"id":"agent-relay-299","title":"Threads: verify end-to-end functionality","description":"## Status\\n\\n**Backend: Complete**\\n- Parser: [thread:id] syntax works\\n- Storage: thread column with index\\n- Protocol: thread in payloads\\n\\n**Frontend: Needs work**\\n- MessageList needs thread badge display\\n- Needs thread filter UI\\n\\nWaiting for Frontend to complete Tailwind work first.","status":"closed","priority":1,"issue_type":"task","assignee":"Protocol","created_at":"2025-12-29T15:33:42.130652-05:00","updated_at":"2025-12-29T15:53:54.083505-05:00","closed_at":"2025-12-29T15:49:55.229555-05:00"}
{"id":"agent-relay-2lw","title":"Add agent metadata tracking","description":"Track program, model, task description in agents.json. Better agent discovery.","status":"closed","priority":2,"issue_type":"feature","assignee":"Implementer","created_at":"2025-12-20T21:36:19.741328+01:00","updated_at":"2025-12-22T17:17:25.919228+01:00","closed_at":"2025-12-22T17:17:25.919228+01:00"}
{"id":"agent-relay-2sn","title":"Competitive Analysis: mcp_agent_mail vs agent-relay","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T21:34:44.49366+01:00","updated_at":"2025-12-20T21:36:26.362391+01:00","closed_at":"2025-12-20T21:36:26.362391+01:00"}
{"id":"agent-relay-2uf","title":"Add message threading support","description":"@relay:Bob [thread:feature-123] pattern. Group related messages for better context.","notes":"Current state: thread parsing + protocol/storage support implemented (ParsedCommand.thread, SendPayload.thread, DB messages.thread + filter). Remaining: wire cmd.thread through tmux-wrapper sendRelayCommand -\u003e RelayClient.sendMessage(..., thread) and include thread in injected display/Inbox. See src/wrapper/tmux-wrapper.ts sendRelayCommand + handleIncomingMessage.","status":"closed","priority":2,"issue_type":"feature","assignee":"SecondLead","created_at":"2025-12-20T21:36:19.631448+01:00","updated_at":"2025-12-22T17:17:42.876826+01:00","closed_at":"2025-12-22T17:17:42.876826+01:00"}
{"id":"agent-relay-2z1","title":"ACK messages not used for reliability","description":"In connection.ts:114-116, ACK messages are accepted but not processed. The protocol supports reliable delivery with ACK/NACK but it's not implemented. Need to: (1) Track unACKed messages, (2) Implement retry logic, (3) Add configurable TTL for messages.","status":"closed","priority":2,"issue_type":"feature","assignee":"LeadDev","created_at":"2025-12-20T00:17:43.615251+01:00","updated_at":"2025-12-20T21:56:07.202292+01:00","closed_at":"2025-12-20T21:56:07.202292+01:00"}
{"id":"agent-relay-300","title":"Dashboard: view previous conversations from database","description":"Add ability to view previous conversations in depth from the dashboard. Use the adapter pattern to load historical conversations from the database. Features: browse past sessions, view full message history, search/filter conversations, see agent interactions over time.","status":"closed","priority":1,"issue_type":"feature","assignee":"Backend","created_at":"2025-12-29T15:39:29.401085-05:00","updated_at":"2025-12-29T15:52:36.077836-05:00","closed_at":"2025-12-29T15:51:30.767209-05:00"}
{"id":"agent-relay-301","title":"Update agent communication protocol to use threads","description":"All agents should use threads whenever possible to help focus conversations. Update CLAUDE.md, agent-relay-snippet.md, and agent documentation to encourage thread usage. Threads help keep related messages grouped and reduce noise in the general channel.","status":"closed","priority":1,"issue_type":"task","assignee":"Frontend","created_at":"2025-12-29T15:48:36.264668-05:00","updated_at":"2025-12-29T15:52:36.056066-05:00","closed_at":"2025-12-29T15:52:36.056066-05:00"}
{"id":"agent-relay-302","title":"History page: dedicated frontend view for conversation history","description":"Create a dedicated History page in the dashboard (not just a modal). Should be a full page view with proper navigation. Coordinate with Backend on existing ConversationHistory component and API endpoints. Features: browse sessions, search/filter, view full conversations.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-29T15:52:45.782267-05:00","updated_at":"2025-12-29T16:11:27.097909-05:00","closed_at":"2025-12-29T16:05:07.11927-05:00"}
{"id":"agent-relay-303","title":"Message received indicator: show ACK before agent responds","description":"Dashboard should show when a message was received by an agent before they start responding.\n\nCurrent state: ThinkingIndicator shows when agent is actively processing/responding.\n\nGap: No indication between message sent â†’ message received by agent.\n\nNeeded:\n1. Show 'received' indicator immediately when ACK comes back from agent\n2. Transition to 'thinking/typing' indicator when agent starts processing\n3. Clear indicator when response is sent\n\nUI states: Sending â†’ Received (checkmark) â†’ Thinking (pulsing) â†’ Response\n\nThis gives users confidence their message was delivered even if agent takes time to respond.","status":"closed","priority":1,"issue_type":"feature","assignee":"Messenger","created_at":"2025-12-29T15:57:03.967858-05:00","updated_at":"2025-12-30T21:17:31.064722+01:00","closed_at":"2025-12-30T21:13:03.683869+01:00"}
{"id":"agent-relay-304","title":"Dashboard: live agent logs viewer","description":"Add ability to view live logs of an individual agent in the dashboard.\n\nOptions:\n1. Integrated in chat - show agent's terminal output inline with messages\n2. Dedicated logs page/panel - full terminal view for selected agent\n\nFeatures needed:\n- Real-time log streaming from agent's PTY\n- Filter/search logs\n- Scroll back through history\n- Toggle between chat view and logs view\n\nThis helps users see what an agent is actually doing (tool calls, errors, thinking) beyond just relay messages.","status":"closed","priority":1,"issue_type":"feature","assignee":"Backend","created_at":"2025-12-29T16:00:22.791859-05:00","updated_at":"2025-12-29T16:11:01.354186-05:00","closed_at":"2025-12-29T16:11:01.354186-05:00"}
{"id":"agent-relay-305","title":"Implement shadow-as-subagent architecture","description":"Replace separate shadow agent processes with Claude Code/OpenCode subagent model.\n\n## Proposal Document\nSee: docs/proposals/shadow-as-subagent.md\n\n## Summary\n- Shadow agents run as Task tool subagents when primary is Claude/OpenCode\n- Fallback to process mode for other CLIs (using authenticated Claude/OpenCode)\n- ~50% resource reduction, instant spawn, direct context sharing\n\n## Key Deliverables\n1. Shadow CLI selection logic (src/bridge/shadow-cli.ts)\n2. Shadow agent profiles for Claude Code and OpenCode\n3. PRPM package for distribution\n4. Updated SpawnModal UI\n5. Integration with existing relay architecture","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2025-12-29T20:28:22.077554-05:00","updated_at":"2025-12-30T21:53:39.633188+01:00"}
{"id":"agent-relay-306","title":"Add 'Start Conversation' UI to dashboard","description":"Currently users can only reply to existing messages. Add ability to start a new conversation/thread with an agent directly.\n\n## Requirements\n- Add 'New Message' or 'Start Conversation' button\n- Allow selecting target agent\n- Create thread on first message\n- Integrate with existing MessageComposer\n\n## Files\n- src/dashboard/react-components/App.tsx\n- src/dashboard/react-components/BroadcastComposer.tsx (reference)\n- src/dashboard/react-components/ThreadPanel.tsx","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-29T20:34:48.598318-05:00","updated_at":"2025-12-29T20:50:07.219241-05:00","closed_at":"2025-12-29T20:50:07.219241-05:00"}
{"id":"agent-relay-307","title":"Stream logs for daemon-connected agents (not just spawned)","description":"Currently logs only stream for workers spawned via AgentSpawner. Agents that connect directly to the daemon (via relay CLI) don't have their logs available in the dashboard.\n\n## Problem\n- spawner.hasWorker(agentName) returns false for daemon-connected agents\n- No PTY wrapper exists for these agents to capture output\n\n## Potential Solutions\n1. Have daemon-connected agents send log output via relay protocol\n2. Add AGENT_LOG message type to protocol\n3. Router forwards logs to dashboard WebSocket\n\n## Files\n- src/daemon/server.ts (line 847 - spawner check)\n- src/protocol/types.ts (add LOG message type?)\n- src/wrapper/client.ts (add log sending capability)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T20:35:29.626072-05:00","updated_at":"2025-12-29T20:50:07.365284-05:00","closed_at":"2025-12-29T20:50:07.365284-05:00"}
{"id":"agent-relay-308","title":"Cloud stack hardening","description":"Group fixes to cloud workspace runtime, credential handling, API security, and schema/provisioning resilience surfaced in recent architecture review.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-30T12:21:10.819956+01:00","updated_at":"2025-12-30T12:21:10.819956+01:00"}
{"id":"agent-relay-308.1","title":"Workspace image and provisioner contract","description":"Workspace container currently only runs agent-relay up and ignores injected repo/provider config; Fly mapping uses port 3000 while the image listens on 3888. Deliver an entrypoint that syncs credentials, clones repos, starts daemon on the port the provisioner exposes, and align port/healthcheck wiring across Fly/Railway/Docker.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-30T12:21:31.787155+01:00","updated_at":"2025-12-30T12:27:05.211805+01:00","closed_at":"2025-12-30T12:27:05.211805+01:00","dependencies":[{"issue_id":"agent-relay-308.1","depends_on_id":"agent-relay-308","type":"parent-child","created_at":"2025-12-30T21:17:31.067109+01:00","created_by":"import"}]}
{"id":"agent-relay-308.2","title":"Vault consistency for provider credentials","description":"Provider credential flow must route through vault, but GitHub/Nango-managed tokens will be supplied externally. Ensure vault handles non-Nango providers, verify CLI-based flows instead of placeholder tokens, and document that provider tokens via Nango are injected separately (do not re-encrypt those).","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-30T12:21:36.20614+01:00","updated_at":"2025-12-30T12:30:02.119433+01:00","dependencies":[{"issue_id":"agent-relay-308.2","depends_on_id":"agent-relay-308","type":"parent-child","created_at":"2025-12-30T21:17:31.067729+01:00","created_by":"import"}]}
{"id":"agent-relay-308.3","title":"Cloud API security hardening","description":"Server promises CSRF, rate limiting, audit logging, and secure cookies but they are absent. Add CSRF protection, rate limiting, audit logs, trust-proxy/sameSite/secure cookie settings, and session/Redis resilience; surface agent/daemon auth plan if applicable.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-30T12:21:40.511937+01:00","updated_at":"2025-12-30T12:31:32.785415+01:00","closed_at":"2025-12-30T12:31:32.785415+01:00","dependencies":[{"issue_id":"agent-relay-308.3","depends_on_id":"agent-relay-308","type":"parent-child","created_at":"2025-12-30T21:17:31.068283+01:00","created_by":"import"}]}
{"id":"agent-relay-308.4","title":"DB/migration alignment and provisioning resilience","description":"Init SQL diverges from Drizzle schema, and provisioning/state management lacks persistence/retries. Generate migrations that match current schema, retire or update init-db.sql, persist device-flow state in Redis, and add retry/backoff/health checks for provisioning + daemon health reporting.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T12:21:44.700579+01:00","updated_at":"2025-12-30T12:36:37.902328+01:00","closed_at":"2025-12-30T12:36:37.902328+01:00","dependencies":[{"issue_id":"agent-relay-308.4","depends_on_id":"agent-relay-308","type":"parent-child","created_at":"2025-12-30T21:17:31.06881+01:00","created_by":"import"}]}
{"id":"agent-relay-309","title":"Complete agent logs rendering in dashboard","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-12-30T13:34:02.250273+01:00","updated_at":"2025-12-30T21:37:19.558278+01:00"}
{"id":"agent-relay-30fu","title":"Fix dashboard conversation routing logic","description":"Conversation routing in the dashboard needs fixing: 1) If conversation starts in DM, it should continue in DM. 2) If conversation starts in general channel, it should flow to general. 3) Messages without '@' should naturally broadcast to everyone.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-28T22:05:12.683854-05:00","updated_at":"2025-12-28T22:06:29.421436-05:00","closed_at":"2025-12-28T22:06:29.421436-05:00","close_reason":"Fixed by Frontend agent"}
{"id":"agent-relay-310","title":"Wire up TrajectoryViewer component in dashboard","description":"TrajectoryViewer component exists but is currently not imported or used anywhere in the dashboard. Need to wire it up to display agent decision trajectories/paths. Component location: src/dashboard/react-components/TrajectoryViewer.tsx","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-30T20:51:48.418742+01:00","updated_at":"2025-12-30T20:51:57.289495+01:00"}
{"id":"agent-relay-311","title":"Wire up TrajectoryViewer component","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-30T20:52:15.248077+01:00","updated_at":"2025-12-30T20:52:15.248077+01:00"}
{"id":"agent-relay-312","title":"agent-relay: running non-existent command creates orphan agent connection","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-30T21:07:03.601723+01:00","updated_at":"2025-12-30T21:07:03.601723+01:00"}
{"id":"agent-relay-313","title":"pty-wrapper missing thread info in message injection","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-30T21:07:04.495862+01:00","updated_at":"2025-12-30T21:07:04.495862+01:00"}
{"id":"agent-relay-314","title":"Add spawn validation and error feedback for agents","description":"When spawning agents via relay patterns or API, validate inputs and provide direct feedback on errors. Examples: CLI typos (e.g., 'claud' instead of 'claude') should be caught and reported back. Invalid agent names should be rejected with clear error messages. Spawn failures should notify the requesting agent immediately. Consider a 'did you mean?' suggestion for common typos. This will make the system more deterministic and help agents self-correct when spawn requests fail.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:44:07.219733+01:00","updated_at":"2025-12-30T22:44:07.219733+01:00"}
{"id":"agent-relay-315","title":"LogViewer shows disconnect errors (1006) even when agent is alive","description":"The LogViewer component is showing repeated 'Disconnected from log stream (code: 1006)' messages even when the agent is still alive and running. This is a UX issue that confuses users about the actual state of the agent. WebSocket error code 1006 indicates an abnormal closure. Need to investigate why the WebSocket connection is dropping and either fix the connection stability or improve error handling/reconnection logic.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-30T22:58:19.931403+01:00","updated_at":"2025-12-30T23:04:14.778991+01:00","closed_at":"2025-12-30T23:03:54.073669+01:00"}
{"id":"agent-relay-316","title":"Thread notification indicator missing in sidebar","description":"The sidebar should show a notification indicator for threads with unread messages, but this indicator is not visible. Need to investigate whether the indicator component exists but isn't rendering, or if it needs to be implemented.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-30T22:58:45.473431+01:00","updated_at":"2025-12-30T23:04:58.415726+01:00","closed_at":"2025-12-30T23:04:58.415726+01:00"}
{"id":"agent-relay-317","title":"Make Threads sidebar collapsible","description":"Added localStorage persistence for threads collapsed state in Sidebar.tsx. The ThreadList component already had full collapse/expand UI with toggle button, chevron icon, and conditional rendering. Now the collapsed state persists across page reloads.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T21:00:57.490669+01:00","updated_at":"2025-12-31T21:03:20.51811+01:00","closed_at":"2025-12-31T21:01:02.392896+01:00"}
{"id":"agent-relay-318","title":"Add team assignment support to agent spawn command","description":"Currently the -\u003erelay:spawn command creates agents but doesn't support assigning them to a specific team. Add support for team assignment in the spawn syntax, e.g.: -\u003erelay:spawn AgentName claude --team=Dashboard 'task description'. This would allow better organization of spawned agents and automatic team membership.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-31T21:12:47.046439+01:00","updated_at":"2025-12-31T21:12:55.078684+01:00"}
{"id":"agent-relay-319","title":"Make notification filtering use dynamic current user instead of hardcoded 'Dashboard'","description":"The notification fix in useMessages.ts:124-125 hardcodes 'Dashboard' to filter out the current user's own messages. This is brittle - when other human users join the chat, they'll see notifications for their own messages. Should dynamically detect the current user's identity (from auth context, session, or websocket connection) and use that for the filter.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-31T21:18:19.280325+01:00","updated_at":"2025-12-31T21:18:19.280325+01:00"}
{"id":"agent-relay-320","title":"Agent Relay logo: mission-control neon mark","description":"Design a scalable Agent Relay logo with mission-control deep space look. Requirements: works on dark backgrounds, cyan #00d9ff glow variant; accents: orange #ff6b35, purple #a855f7, teal/green #00ffc8; explore network/relay nodes, signal waves, abstract AR monogram, orbital/satellite cues, or circuit patterns. Deliver SVG and PNGs (32,64,128,256,512) saved to src/dashboard/public/logos/.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T20:07:33.380814+01:00","updated_at":"2026-01-01T20:09:58.339797+01:00","closed_at":"2026-01-01T20:09:58.339797+01:00"}
{"id":"agent-relay-321","title":"Set up cloud infrastructure: Neon Postgres, Upstash Redis, GitHub OAuth","description":"Set up required cloud services for Fly.io deployment:\n\n1. **Neon Postgres** (https://neon.tech) âœ… DONE\n   - Create project\n   - Get DATABASE_URL connection string\n   - Add to Fly secrets\n\n2. **Upstash Redis** (https://upstash.com) âœ… DONE\n   - Create Redis database\n   - Get REDIS_URL\n   - Add to Fly secrets\n\n3. **GitHub OAuth App** (https://github.com/settings/applications/new)\n   - Homepage URL: https://agent-relay.com\n   - Callback URL: https://agent-relay.com/api/auth/github/callback\n   - Get GITHUB_CLIENT_ID and GITHUB_CLIENT_SECRET\n   - Add to Fly secrets\n\nAfter setup, run:\nfly secrets set -a agent-relay \\\n  DATABASE_URL=\"...\" \\\n  REDIS_URL=\"...\" \\\n  GITHUB_CLIENT_ID=\"...\" \\\n  GITHUB_CLIENT_SECRET=\"...\"","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-01T22:13:58.300333+01:00","updated_at":"2026-01-01T22:52:01.408274+01:00"}
{"id":"agent-relay-322","title":"Scale up Fly Postgres when traffic increases","description":"Commands to scale Postgres:\n\n# Increase VM size\nfly postgres config update agent-relay-db --vm-size shared-cpu-2x\n\n# Increase disk size  \nfly postgres config update agent-relay-db --volume-size 10\n\n# For high availability, add replicas\nfly postgres config update agent-relay-db --initial-cluster-size 2","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-01T22:51:21.512642+01:00","updated_at":"2026-01-01T22:51:32.021283+01:00"}
{"id":"agent-relay-323","title":"Scale up Fly Redis when traffic increases","description":"Commands to scale Redis (Upstash):\n\n# Check current usage\nfly redis status agent-relay-redis\n\n# Add replica regions for read scaling\nfly redis update agent-relay-redis --replica-regions lax,sea\n\n# For higher limits, upgrade via Upstash console:\n# https://console.upstash.com/\n\n# Or recreate with replicas\nfly redis create --name agent-relay-redis-v2 --region sjc --replica-regions lax","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-01T22:51:22.779079+01:00","updated_at":"2026-01-01T22:51:33.60617+01:00"}
{"id":"agent-relay-324","title":"Switch from GitHub OAuth to GitHub App for repo access","description":"Current OAuth approach has limitations. Need GitHub App for:\n\n1. **Cloning private repos** in workspaces\n   - Generate installation access tokens\n   - Use for git clone in provisioned containers\n\n2. **GitHub API write access**\n   - Create issues\n   - Create pull requests\n   - Comment on PRs\n   - Manage branches\n\n3. **Organization-level installation**\n   - Admin installs once\n   - All org repos accessible\n   - Not tied to individual user\n\n## Implementation Steps\n\n1. Create GitHub App in GitHub settings:\n   - Permissions: contents:read, issues:write, pull_requests:write, metadata:read\n   - Webhook URL for installation events\n   - Generate private key\n\n2. Add app installation flow:\n   - POST /api/github/install â†’ redirect to GitHub App install\n   - GET /api/github/callback â†’ handle installation callback\n   - Store installation ID per org/user\n\n3. Generate installation tokens:\n   - JWT signed with private key\n   - Exchange for installation access token\n   - Use for git clone and API calls\n\n4. Update workspace provisioner:\n   - Pass installation token to container\n   - Clone repos using token\n   - Refresh token when expired (1 hour expiry)\n\n5. Add GitHub API service:\n   - createIssue(repo, title, body)\n   - createPR(repo, head, base, title, body)\n   - addComment(repo, issueNumber, body)\n\n## Environment Variables Needed\n- GITHUB_APP_ID\n- GITHUB_APP_PRIVATE_KEY (base64 encoded)\n- GITHUB_APP_WEBHOOK_SECRET\n- GITHUB_APP_CLIENT_ID (for OAuth fallback)\n- GITHUB_APP_CLIENT_SECRET","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-01T23:07:00.816801+01:00","updated_at":"2026-01-01T23:07:00.816801+01:00"}
{"id":"agent-relay-325","title":"Add repo context indicator in header with quick switcher","description":"Add Slack-style repo indicator in the header.\n\n## Current State\n- No clear indication of which repo you're working in\n- Have to look at sidebar to see context\n\n## Desired UX\n- Header shows: 'myorg/frontend â–¼'\n- Click dropdown to see all repos in workspace\n- Quick switch without opening command palette\n- Show git branch next to repo name\n\n## Implementation\n1. Add RepoContextHeader component\n2. Dropdown with repo list from current workspace\n3. Click to switch repo context\n4. Show current branch (from WorkspaceSelector logic)\n\n## Location\nsrc/dashboard/react-components/layout/Header.tsx (or new component)","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-01T23:12:00.536911+01:00","updated_at":"2026-01-01T23:12:00.536911+01:00"}
{"id":"agent-relay-326","title":"Make Cmd+K default to repos/projects first","description":"Improve command palette to be more Slack-like for repo switching.\n\n## Current State\n- Cmd+K opens palette with all categories mixed\n- Projects are one category among many\n- Have to scroll/search to find repos\n\n## Desired UX\n- Cmd+K opens with repos/projects as first/default category\n- Recent repos at top of list\n- Current repo visually indicated\n- Tab to switch between categories\n- Cmd+Shift+K for full palette (agents, actions, settings)\n\n## Implementation\n1. Modify CommandPalette.tsx to prioritize Projects category\n2. Add 'recent projects' tracking (localStorage or state)\n3. Add Tab key handler to cycle categories\n4. Add visual indicator for current project\n5. Optional: Cmd+Shift+K binding for full palette\n\n## Files\n- src/dashboard/react-components/CommandPalette.tsx\n- src/dashboard/react-components/App.tsx (keybindings)","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-01T23:12:02.203413+01:00","updated_at":"2026-01-01T23:12:02.203413+01:00"}
{"id":"agent-relay-327","title":"Add recent repos quick access","description":"Track and display recently accessed repos for quick switching.\n\n## Current State\n- No memory of recently used repos\n- Have to search every time\n\n## Desired UX\n- Recent repos shown at top of command palette\n- Recent repos in header dropdown\n- Keyboard shortcut (Cmd+1, Cmd+2) for top 2 recent\n- Persist across sessions\n\n## Implementation\n1. Add useRecentRepos hook\n2. Store in localStorage (last 5-10 repos)\n3. Update on repo switch\n4. Display in CommandPalette Projects section\n5. Display in header dropdown\n6. Optional: Cmd+1/2/3 shortcuts\n\n## Files\n- src/dashboard/hooks/useRecentRepos.ts (new)\n- src/dashboard/react-components/CommandPalette.tsx\n- src/dashboard/react-components/RepoContextHeader.tsx","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-01T23:12:03.507573+01:00","updated_at":"2026-01-01T23:12:03.507573+01:00"}
{"id":"agent-relay-328","title":"Document cross-project messaging syntax for agents","description":"The parser supports cross-project messaging but agents don't know about it.\n\n## Current Syntax (supported but undocumented)\n\n```\n-\u003erelay:project-id:AgentName \u003c\u003c\u003c\nMessage to agent in another project\u003e\u003e\u003e\n\n-\u003erelay:project-id:* \u003c\u003c\u003c\nBroadcast to all agents in that project\u003e\u003e\u003e\n\n-\u003erelay:project-id:lead \u003c\u003c\u003c\nMessage to lead agent of that project\u003e\u003e\u003e\n```\n\n## Files to Update\n\n1. **docs/agent-relay-snippet.md** - Add cross-project section\n2. **CLAUDE.md** - Update the snippet (or it auto-updates)\n3. **.claude/skills/using-agent-relay/SKILL.md** - If exists\n\n## Content to Add\n\n```markdown\n## Cross-Project Messaging (Bridge Mode)\n\nWhen running with `agent-relay bridge`, you can message agents in other projects:\n\n```\n-\u003erelay:frontend:Designer \u003c\u003c\u003c\nPlease update the UI for the new auth flow\u003e\u003e\u003e\n\n-\u003erelay:backend:* \u003c\u003c\u003c\nAPI changes deployed, please pull latest\u003e\u003e\u003e\n\n-\u003erelay:shared-lib:lead \u003c\u003c\u003c\nNeed a new utility function for date formatting\u003e\u003e\u003e\n```\n\nFormat: `-\u003erelay:project-id:agent-name`\n```\n\n## Also Consider\n- How agents discover available projects\n- How to query which agents are in which project\n- Cross-project thread syntax: `[thread:project:topic]`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T23:17:09.740345+01:00","updated_at":"2026-01-01T23:19:22.409354+01:00","closed_at":"2026-01-01T23:19:22.409354+01:00"}
{"id":"agent-relay-329","title":"Dashboard: Show connected repos/projects indicator","description":"When multiple repos are connected (bridge mode or multi-repo workspace), the dashboard should visually indicate this.\n\n## Current State\n- Dashboard shows agents but no clear indication of which project/repo they belong to\n- No visual cue that multiple projects are bridged\n\n## Desired UX\n\n### Option A: Project badges on agents\nEach agent shows a small badge/tag with their project:\n```\n[frontend] Designer - active\n[backend] API-Dev - idle  \n[shared] Utils - active\n```\n\n### Option B: Grouped sidebar\nProjects as collapsible sections (already partially exists in ProjectList):\n```\nâ–¼ frontend (3 agents)\n  - Designer\n  - Implementer\n  - Reviewer\nâ–¼ backend (2 agents)\n  - API-Dev\n  - DBAdmin\n```\n\n### Option C: Header indicator\nShow connected projects count in header:\n```\nðŸ”— 3 projects connected | Current: frontend\n```\n\n## Implementation Notes\n- Check ProjectList.tsx - already has project grouping logic\n- May need to enhance Header.tsx for connection indicator\n- Consider color-coding projects for quick identification\n\n## Files\n- src/dashboard/react-components/ProjectList.tsx\n- src/dashboard/react-components/layout/Header.tsx\n- src/dashboard/react-components/AgentList.tsx (for badges)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T23:19:14.394353+01:00","updated_at":"2026-01-01T23:22:31.628165+01:00","closed_at":"2026-01-01T23:22:31.628165+01:00"}
{"id":"agent-relay-330","title":"Add --architect flag to bridge command for cross-project coordinator","description":"When running bridge mode, optionally spawn an architect agent that coordinates across all projects.\n\n## Usage\n```bash\nagent-relay bridge --architect ~/frontend ~/backend\n# or\nagent-relay bridge --architect claude ~/frontend ~/backend\n```\n\n## Behavior\n1. Bridge connects to all project daemons (existing behavior)\n2. Spawns an Architect agent in a tmux session\n3. Architect agent has access to cross-project messaging:\n   - -\u003erelay:project:agent for direct messages\n   - -\u003erelay:*:* for broadcast to all\n   - -\u003erelay:project:lead for project leads\n4. Architect gets injected with context about connected projects\n\n## Implementation\n- Add --architect flag to bridge command\n- Create temp workspace or use first project as base\n- Spawn tmux wrapper with Architect agent\n- Inject system prompt with project list and cross-project syntax\n\n## Agent Definition\nCould use .claude/agents/architect.md if exists, otherwise default prompt:\n- You are the Architect coordinating: [project list]\n- Use cross-project messaging syntax\n- Assign tasks to project leads\n- Resolve dependencies","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T23:29:07.473839+01:00","updated_at":"2026-01-01T23:35:27.952802+01:00","closed_at":"2026-01-01T23:35:27.952802+01:00"}
{"id":"agent-relay-37i","title":"Message deduplication uses in-memory Set without limits","description":"In tmux-wrapper.ts:65, sentMessageHashes is a Set that grows unbounded. For long-running sessions, this could cause memory issues. Add: (1) Max size with LRU eviction, (2) Time-based expiration, (3) Bloom filter alternative for memory efficiency.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T00:18:47.229988+01:00","updated_at":"2025-12-20T00:18:47.229988+01:00"}
{"id":"agent-relay-3px","title":"Add playbook system for batch automation","description":"Implement playbook system (like Maestro's Auto Run) for batch-processing task lists through agents. Define workflows in YAML/markdown, execute automatically with context isolation. Enables reproducible multi-step automation.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-23T17:04:54.464749+01:00","updated_at":"2025-12-23T17:04:54.464749+01:00"}
{"id":"agent-relay-3tx","title":"PR-9 Review: Document configurable timeouts","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-22T21:54:15.789418+01:00","updated_at":"2025-12-22T21:54:15.789418+01:00"}
{"id":"agent-relay-3y1","title":"Fix dashboard auto-scroll interfering with manual scrolling","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-24T15:09:41.112636+01:00","updated_at":"2025-12-24T15:10:59.748796+01:00","closed_at":"2025-12-24T15:10:59.748796+01:00"}
{"id":"agent-relay-41f","title":"BUG: better-sqlite3 bindings fail on Node 25","description":"agent-relay read command fails with 'Could not locate the bindings file' on Node v25.2.1. Need to rebuild bindings or use compatible Node version.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-20T21:46:24.882216+01:00","updated_at":"2025-12-20T21:49:56.89756+01:00","closed_at":"2025-12-20T21:49:56.89756+01:00"}
{"id":"agent-relay-43sp","title":"Migrate dashboard to Tailwind CSS","description":"Current dashboard uses plain CSS with styles split across globals.css and component files. Migrating to Tailwind would:\n- Provide consistent utility classes\n- Simplify component styling\n- Better responsive design patterns\n- Eliminate CSS organization confusion\n\nKey areas to migrate:\n- globals.css sidebar/header/message styles\n- Component-specific styles (AgentCard, ProjectList, etc.)\n- Add tailwind.config.js with dark theme\n- Update Next.js config for Tailwind","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-29T09:19:19.257642-05:00","updated_at":"2025-12-29T15:53:54.084499-05:00","closed_at":"2025-12-29T15:42:28.292321-05:00"}
{"id":"agent-relay-47z","title":"Express 5 may have breaking changes from Express 4 patterns","description":"package.json uses express@5.2.1 which is a major version with breaking changes from Express 4. Verify: (1) Error handling middleware patterns, (2) Router behavior, (3) Body parsing (express.json vs body-parser).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T00:18:49.269841+01:00","updated_at":"2025-12-20T00:18:49.269841+01:00"}
{"id":"agent-relay-4e0","title":"Fix message truncation - messages cut off at source","description":"Root cause found: parser.ts:40 inline regex only captures single line. Multi-line messages are split by parsePassThrough() at line 206. Fix options: (1) Allow continuation lines in inline format, (2) Use block format for multi-line, (3) Add heuristic to join lines until next @relay pattern.","status":"closed","priority":2,"issue_type":"bug","assignee":"MistyShelter","created_at":"2025-12-19T23:40:35.082717+01:00","updated_at":"2025-12-20T00:03:54.806087+01:00","closed_at":"2025-12-20T00:03:54.806087+01:00"}
{"id":"agent-relay-4ft","title":"Merge project info into status command","status":"closed","priority":2,"issue_type":"task","assignee":"Pruner","created_at":"2025-12-19T21:59:52.685495+01:00","updated_at":"2025-12-19T22:06:44.276187+01:00","closed_at":"2025-12-19T22:06:44.276187+01:00"}
{"id":"agent-relay-4jv","title":"Add session discovery from existing Claude Code","description":"Auto-discover and import existing Claude Code sessions (like Maestro). Detect running claude processes, offer to wrap them with agent-relay messaging. Reduces friction for adoption - users don't have to restart their agents.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-23T17:05:01.003851+01:00","updated_at":"2025-12-23T17:05:01.003851+01:00"}
{"id":"agent-relay-4oy","title":"Fix beads sync prefix mismatch errors","description":"During bd sync, getting 'prefix mismatch detected: database uses agent-relay- but found issues with prefixes: agent- (5 issues)'. Need to investigate and fix the prefix inconsistency or use --rename-on-import flag.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-23T23:10:12.720183+01:00","updated_at":"2025-12-23T23:10:12.720183+01:00"}
{"id":"agent-relay-4vl","title":"PR-9 Review: Add unit tests for AgentSpawner","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T21:54:03.195295+01:00","updated_at":"2025-12-22T22:00:57.315234+01:00","closed_at":"2025-12-22T22:00:57.315234+01:00"}
{"id":"agent-relay-4xs","title":"Dashboard: Enter to send, Shift+Enter for newline (Slack-style)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-24T15:25:01.248707+01:00","updated_at":"2025-12-24T15:26:24.619384+01:00","closed_at":"2025-12-24T15:26:24.619384+01:00"}
{"id":"agent-relay-51u","title":"Outgoing messages truncated before delivery","description":"Agent messages are being cut off mid-sentence. Examples: 'Updates for mcl/2z1:' and 'Signing off. Progress report:' - both end abruptly. May be related to capture-pane buffer limits, parser issues, or injection timing. Investigate: (1) capture-pane -S - scrollback limits, (2) parser line joining, (3) message storage truncation.","notes":"PROGRESS: Reproduced truncation in tmux wrapper/relay flow. Likely due to display truncation on injection length and terminal capture limitations. No code changes yet.","status":"closed","priority":1,"issue_type":"bug","assignee":"Implementer","created_at":"2025-12-20T21:50:11.411952+01:00","updated_at":"2025-12-22T13:48:45.264136+01:00","closed_at":"2025-12-22T13:48:45.264136+01:00"}
{"id":"agent-relay-52d","title":"Add metrics/observability for daemon","description":"No way to monitor daemon health, message throughput, or agent activity. Add: (1) /metrics endpoint for Prometheus, (2) Message count/rate stats, (3) Connection lifecycle events, (4) Error rate tracking.","status":"closed","priority":2,"issue_type":"feature","assignee":"FEDev","created_at":"2025-12-20T00:18:48.378728+01:00","updated_at":"2025-12-25T13:59:43.376287+01:00","closed_at":"2025-12-25T13:59:43.376287+01:00"}
{"id":"agent-relay-52e","title":"Unify bridge view with dashboard UI","description":"Make bridge view feel like the main dashboard with project tabs, same agent/messaging UI, spawn capability at bridge level, and ability to click into individual project dashboards","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-25T13:44:11.491787+01:00","updated_at":"2025-12-25T13:49:36.007645+01:00","closed_at":"2025-12-25T13:49:36.007645+01:00"}
{"id":"agent-relay-5af","title":"Hook doesn't integrate with daemon-based messaging","description":"hooks/inbox-check/hook.ts reads from file-based inbox but the daemon uses SQLite. When using daemon mode, the hook won't see messages. Need to: (1) Query daemon storage, (2) Or ensure inbox files are written in daemon mode too.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-20T00:18:35.503078+01:00","updated_at":"2025-12-20T00:18:35.503078+01:00"}
{"id":"agent-relay-5fa","title":"Add exponential backoff for daemon reconnection","description":"Implement graceful reconnection with exponential backoff delays [100, 500, 1000, 2000, 5000ms]. After max attempts, operate offline gracefully. See docs/TMUX_IMPROVEMENTS.md for implementation details.","status":"closed","priority":2,"issue_type":"feature","assignee":"LeadDev","created_at":"2025-12-20T21:28:48.055013+01:00","updated_at":"2025-12-20T21:33:42.229756+01:00","closed_at":"2025-12-20T21:33:42.229756+01:00"}
{"id":"agent-relay-5g0","title":"Heartbeat timeout could be more configurable","description":"In connection.ts:196, heartbeat timeout is hardcoded as 2x heartbeatMs. This should be independently configurable. Also, heartbeat failures immediately kill the connection - could implement exponential backoff for transient issues.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T00:18:03.556614+01:00","updated_at":"2025-12-23T23:03:07.563273+01:00","closed_at":"2025-12-23T23:03:07.563273+01:00"}
{"id":"agent-relay-68a","title":"Ask pattern: request/response messaging (replyTo + deferred)","description":"Implement an RPC-like ask() over agent-relay: sender creates a short-lived deferred handle, sends message with replyTo, receiver responds resolving the deferred. Similar to swarm-mail DurableDeferred + ask/respond.","acceptance_criteria":"- ask() returns response or times out\\n- Deferreds are persisted with TTL\\n- Works across process restarts/reconnects","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T21:44:33.930531+01:00","updated_at":"2025-12-20T21:44:33.930531+01:00","labels":["coordination","protocol"]}
{"id":"agent-relay-6dl8","title":"Multi-line relay messages truncated in dashboard display","description":"Multi-line messages sent via -\u003erelay: are being cut off after first line when displayed in dashboard. This blocks communication between agents. Need to: (1) Verify daemon sends full message, (2) Fix dashboard rendering to handle newlines properly.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T12:28:39.746942+01:00","updated_at":"2025-12-26T12:38:36.844034+01:00","closed_at":"2025-12-26T12:38:36.844034+01:00"}
{"id":"agent-relay-6mo","title":"Lead spawn capability not working (@relay:spawn pattern)","description":"The lead command advertises spawn capability via @relay:spawn pattern but it's not fully implemented. Agents started with 'agent-relay lead' should be able to spawn workers, but the parser extension mentioned in the code is not implemented.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T12:14:59.492237+01:00","updated_at":"2025-12-23T12:18:14.114911+01:00","closed_at":"2025-12-23T12:18:14.114911+01:00"}
{"id":"agent-relay-6nx","title":"Add activity state tracking for better injection timing","description":"Track active/idle/disconnected state with timestamps. When session goes idle (30s no activity), trigger message injection opportunity. Improves injection timing vs current fixed 1.5s wait. See docs/TMUX_IMPROVEMENTS.md for implementation details.","status":"closed","priority":2,"issue_type":"feature","assignee":"LeadDev","created_at":"2025-12-20T21:28:46.993856+01:00","updated_at":"2025-12-20T21:33:42.223042+01:00","closed_at":"2025-12-20T21:33:42.223042+01:00"}
{"id":"agent-relay-6ny","title":"Fix message truncation: store full message in SQLite first, include ID in relay","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-19T22:04:36.168862+01:00","updated_at":"2025-12-19T22:08:28.207532+01:00","closed_at":"2025-12-19T22:08:28.207532+01:00"}
{"id":"agent-relay-6rz","title":"Message injection timing can cause race conditions","description":"In tmux-wrapper.ts:564-569, injection waits for 'idle' (1.5s since last output) but this is fragile. If agent produces output during injection, messages could interleave. Consider: (1) Input buffer detection, (2) Bracketed paste mode, (3) Agent-specific injection strategies.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-20T00:18:17.76865+01:00","updated_at":"2025-12-25T14:31:59.858855+01:00","closed_at":"2025-12-25T14:31:59.858855+01:00"}
{"id":"agent-relay-7b2","title":"CRITICAL: Agents cycling between offline/online status","description":"Dashboard reports agents cycling between offline/online. Root cause analysis: Heartbeat timeout in connection.ts line 230 - if PONG not received within 10 seconds (2x heartbeat interval), connection is killed. This is too aggressive for AI agents that may be processing. Fix: increase timeout tolerance or make configurable. See connection.ts:223-244.","status":"closed","priority":0,"issue_type":"bug","assignee":"Lead","created_at":"2025-12-23T22:57:53.052261+01:00","updated_at":"2025-12-23T23:02:41.925425+01:00","closed_at":"2025-12-23T23:02:41.925425+01:00"}
{"id":"agent-relay-7bp","title":"Memory storage adapter has fixed 1000 message limit","description":"In storage/adapter.ts:60-63, MemoryStorageAdapter hard-codes 1000 message limit. This should be configurable and potentially use LRU eviction instead of slice.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T00:17:46.132735+01:00","updated_at":"2025-12-20T00:17:46.132735+01:00"}
{"id":"agent-relay-7fx","title":"PR-9 Review: Fix @relay vs -\u003erelay syntax inconsistency in docs","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-22T22:02:02.782958+01:00","updated_at":"2025-12-22T22:04:02.664058+01:00","closed_at":"2025-12-22T22:04:02.664058+01:00"}
{"id":"agent-relay-7mm","title":"Add orphaned tmux session cleanup","description":"When agent-relay wrapper crashes or gets SIGKILL, the tmux session remains. Need: 1) CLI command to gc orphaned sessions, 2) Daemon-side cleanup on client disconnect","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T15:52:01.58781+01:00","updated_at":"2025-12-22T15:54:59.840769+01:00","closed_at":"2025-12-22T15:54:59.840769+01:00"}
{"id":"agent-relay-7tk","title":"Dashboard truncates multi-line messages","description":"Messages containing line breaks only show the first line in the dashboard. Need to render newlines properly - either with CSS white-space or by converting newlines to \u003cbr\u003e tags.","status":"closed","priority":1,"issue_type":"bug","assignee":"FE-Dev","created_at":"2025-12-23T23:05:03.86361+01:00","updated_at":"2025-12-23T23:05:59.96346+01:00","closed_at":"2025-12-23T23:05:59.96346+01:00"}
{"id":"agent-relay-7tu","title":"Fix storage portability: better-sqlite3 native binding failures","description":"The read command fails in some Node versions (e.g., Node 25) due to missing better-sqlite3 bindings. Decide path: pin supported Node LTS + ensure rebuild, or replace with a non-native option (e.g., Node sqlite, wasm, or a pure JS adapter).","design":"Implement driver selection/fallback: try better-sqlite3, fallback to node:sqlite DatabaseSync when bindings missing. Add env override AGENT_RELAY_SQLITE_DRIVER=node|better-sqlite3. Convert queries to positional params so both drivers share code.","acceptance_criteria":"- dist CLI read works on supported Node versions\\n- CI/build docs reflect supported runtime or replacement adapter","notes":"Implemented sqlite portability: dynamic better-sqlite3 import + fallback to node:sqlite (env override AGENT_RELAY_SQLITE_DRIVER). Updated sqlite adapter to use positional params for compatibility; added/updated tests; npx vitest run passes (216).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T21:44:57.868091+01:00","updated_at":"2025-12-20T21:56:13.384399+01:00","closed_at":"2025-12-20T21:56:13.3844+01:00","labels":["build","storage"]}
{"id":"agent-relay-7yo","title":"Update CLAUDE.md with new CLI commands","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T22:00:02.661859+01:00","updated_at":"2025-12-19T22:07:27.766701+01:00","closed_at":"2025-12-19T22:07:27.766701+01:00","dependencies":[{"issue_id":"agent-relay-7yo","depends_on_id":"agent-relay-85z","type":"blocks","created_at":"2025-12-19T22:00:25.731921+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"agent-relay-7yo","depends_on_id":"agent-relay-4ft","type":"blocks","created_at":"2025-12-19T22:00:25.772241+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"agent-relay-7yo","depends_on_id":"agent-relay-bd0","type":"blocks","created_at":"2025-12-19T22:00:25.80776+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"agent-relay-7yo","depends_on_id":"agent-relay-f3q","type":"blocks","created_at":"2025-12-19T22:00:25.843131+01:00","created_by":"daemon","metadata":"{}"}]}
{"id":"agent-relay-85z","title":"Merge dashboard into start command","status":"closed","priority":2,"issue_type":"task","assignee":"InterfaceManager","created_at":"2025-12-19T21:59:51.61716+01:00","updated_at":"2025-12-19T22:06:44.27487+01:00","closed_at":"2025-12-19T22:06:44.27487+01:00"}
{"id":"agent-relay-8ap","title":"CRITICAL: send command triggers infinite reconnection loop","description":"When sending relay messages to Gem agent, the send command triggers an infinite reconnection loop. Client repeatedly connects with RESUME_TOO_OLD errors, never actually delivers the message. Each connection gets a new session ID and immediately reconnects (~90-110ms apart). This is a critical client/daemon issue, not just Gemini-specific.","notes":"CLI send command removed (keeping surface area small). Root cause still needs investigation - client reconnection loop with RESUME_TOO_OLD errors.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T12:18:13.272843+01:00","updated_at":"2025-12-22T14:37:19.435751+01:00","closed_at":"2025-12-22T14:37:19.435751+01:00"}
{"id":"agent-relay-8fc","title":"Agent auto-complete menu is transparent/invisible","description":"The agent auto-complete dropdown menu in the dashboard appears to be transparent or has visibility issues, making it unusable. Need to debug CSS/z-index/display issues in bridge.html agent selector component.","status":"closed","priority":2,"issue_type":"bug","assignee":"FE-Dev","created_at":"2025-12-24T15:04:53.390674+01:00","updated_at":"2025-12-24T15:30:23.72431+01:00","closed_at":"2025-12-24T15:30:23.72431+01:00"}
{"id":"agent-relay-8ff","title":"Add agent list command to CLI","description":"CLI has up/down/status/read but no way to list connected agents or see message history from command line. Add: (1) agent-relay agents - list connected agents, (2) agent-relay history - show recent messages, (3) agent-relay send \u003cagent\u003e \u003cmsg\u003e - send from CLI.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-20T00:18:34.400432+01:00","updated_at":"2025-12-22T15:35:44.695605+01:00","closed_at":"2025-12-22T15:35:44.695605+01:00"}
{"id":"agent-relay-8nx","title":"SIGINT/SIGTERM handlers don't await cleanup","description":"In cli/index.ts:74-77 and daemon setup, SIGINT handlers call stop() but process.exit(0) runs immediately. The stop() is async but not awaited, potentially leaving socket files or incomplete shutdown.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-20T00:18:19.189514+01:00","updated_at":"2025-12-20T00:18:19.189514+01:00"}
{"id":"agent-relay-8z1","title":"Add CLI tests for new command structure","status":"closed","priority":2,"issue_type":"task","assignee":"Lead","created_at":"2025-12-19T22:00:04.561793+01:00","updated_at":"2025-12-22T17:10:28.100961+01:00","closed_at":"2025-12-22T17:10:28.100961+01:00","dependencies":[{"issue_id":"agent-relay-8z1","depends_on_id":"agent-relay-85z","type":"blocks","created_at":"2025-12-19T22:00:27.632396+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"agent-relay-8z1","depends_on_id":"agent-relay-4ft","type":"blocks","created_at":"2025-12-19T22:00:27.671868+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"agent-relay-8z1","depends_on_id":"agent-relay-bd0","type":"blocks","created_at":"2025-12-19T22:00:27.713889+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"agent-relay-8z1","depends_on_id":"agent-relay-f3q","type":"blocks","created_at":"2025-12-19T22:00:27.752052+01:00","created_by":"daemon","metadata":"{}"}]}
{"id":"agent-relay-90h","title":"Show 'needs attention' indicator when agent is waiting for permissions","description":"Frontend complete: needsAttention field, pulsing indicator, badge. Backend piece still needed: detect when agents are waiting for permissions and set the flag.","status":"closed","priority":1,"issue_type":"feature","assignee":"FE-Dev","created_at":"2025-12-23T22:55:26.87753+01:00","updated_at":"2025-12-24T11:48:32.679452+01:00","closed_at":"2025-12-24T11:48:32.679452+01:00"}
{"id":"agent-relay-9igw","title":"Agents not closing multi-line relay messages with \u003e\u003e\u003e","description":"Agent Relay requires multi-line messages to be wrapped in \u003c\u003c\u003c \u003e\u003e\u003e format with \u003e\u003e\u003e on its own line. Agents are sending multi-line messages without proper closure. This breaks message parsing and relay communication quality.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-28T19:29:43.950026-05:00","updated_at":"2025-12-29T12:00:58.120195-05:00","closed_at":"2025-12-29T15:03:53.917852946Z"}
{"id":"agent-relay-9kc","title":"Add skip-permissions flag for spawned Claude agents","description":"When spawning Claude agents via agent-relay, automatically use --dangerously-skip-permissions to avoid permission dialog delays. Update spawn command in CLI to pass this flag to spawned sessions.","status":"closed","priority":1,"issue_type":"task","assignee":"FEDev","created_at":"2025-12-25T14:09:00.07082+01:00","updated_at":"2025-12-25T14:15:45.925839+01:00","closed_at":"2025-12-25T14:15:45.925839+01:00"}
{"id":"agent-relay-9kw","title":"Add multi-machine agent support","description":"Enable agents to run across multiple machines with centralized coordination. AI Maestro scales to 100+ agents across machines. Extend bridge mode to support remote daemon connections over TCP/WebSocket. Critical for scaling beyond single machine.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-23T17:04:35.521241+01:00","updated_at":"2025-12-23T17:04:35.521241+01:00"}
{"id":"agent-relay-9qa","title":"Dashboard websocket 'Invalid frame header' error on localhost:3888","description":"Websocket connection to ws://localhost:3888/ws fails with 'Invalid frame header' error from browser. Blocking dashboard functionality.","notes":"WS handshake fixed: restored default WebSocket compression (removed perMessageDeflate:false), removed HTTP polling fallback. FE-Dev confirmed 101 upgrade on 127.0.0.1:3888 after rebuild/refresh.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T16:42:29.342087+01:00","updated_at":"2025-12-23T17:04:04.246054+01:00","closed_at":"2025-12-23T17:04:04.246054+01:00"}
{"id":"agent-relay-9uq","title":"Project chat targeting in bridge","description":"Enable sending messages to agents in a selected project from the bridge interface","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T11:47:33.46287+01:00","updated_at":"2025-12-24T11:56:54.182321+01:00","closed_at":"2025-12-24T11:56:54.182321+01:00"}
{"id":"agent-relay-9uy","title":"Durable inbox state (unread/read/acked per recipient)","description":"Implement per-recipient inbox state (unread/read/acked) similar to swarm-mailâ€™s message_recipients projection. Persist and query unread/urgent; expose to dashboard + CLI read/lookup.","acceptance_criteria":"- Can mark message read and acked per recipient\\n- Dashboard/API can query unreadOnly and urgentOnly\\n- State survives daemon restart","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T21:43:46.201965+01:00","updated_at":"2025-12-22T14:25:41.862138+01:00","closed_at":"2025-12-22T14:25:41.862138+01:00","labels":["durability","storage"]}
{"id":"agent-relay-9w0","title":"Auto-detect agent role from .claude/agents or .openagents on init","description":"When an agent connects with a name (e.g., 'Lead'), check .claude/agents/ and .openagents/ directories for a matching agent definition file. If found, include in the initialization message that the agent should assume that role. This enables automatic role assignment without manual configuration.","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2025-12-23T16:26:27.510393+01:00","updated_at":"2025-12-24T08:01:39.714171+01:00"}
{"id":"agent-relay-a4k","title":"Add safety mechanisms for dangerous commands","description":"Implement safety layer for dangerous operations (like ACFS's two-person rule). Require confirmation from second agent or human for destructive commands (rm -rf, git push -f, DROP TABLE). Configurable blocklist and approval workflow.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-23T17:05:21.032206+01:00","updated_at":"2025-12-23T17:05:21.032206+01:00"}
{"id":"agent-relay-ahe","title":"Session resume not implemented - RESUME_TOO_OLD always sent","description":"In connection.ts:140-143, session resume tokens are received but not persisted or validated. The server always responds with RESUME_TOO_OLD. This breaks the resume capability advertised in the protocol. Need to implement token persistence and session state recovery.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-20T00:17:30.605649+01:00","updated_at":"2025-12-22T15:31:05.795905+01:00","closed_at":"2025-12-22T15:31:05.795905+01:00"}
{"id":"agent-relay-aq2","title":"Implement agent-to-agent spawning via relay","description":"Allow agents to spawn new agents through relay messaging. Enable -\u003erelay:spawn pattern so agents can dynamically create specialized sub-agents. This unblocks multi-agent workflows and team hierarchies.","status":"closed","priority":1,"issue_type":"feature","assignee":"BESpecialist","created_at":"2025-12-25T14:14:02.110506+01:00","updated_at":"2025-12-25T14:32:10.400627+01:00","closed_at":"2025-12-25T14:32:10.400627+01:00"}
{"id":"agent-relay-aqy","title":"Display cross-project messages with project badge in dashboard","description":"When messages use @project:agent format, display them in the dashboard with a project badge/indicator. Parse project:agent from the 'to' field and render as [ProjectBadge] @AgentName. Depends on agent-relay-cross-project-parser completing first.","status":"closed","priority":2,"issue_type":"feature","assignee":"FE-Dev","created_at":"2025-12-24T10:29:37.528325+01:00","updated_at":"2025-12-24T11:46:39.341486+01:00","closed_at":"2025-12-24T11:46:39.341486+01:00","dependencies":[{"issue_id":"agent-relay-aqy","depends_on_id":"agent-relay-ytl","type":"blocks","created_at":"2025-12-24T10:29:48.712573+01:00","created_by":"khaliqgant","metadata":"{}"}]}
{"id":"agent-relay-b11","title":"Cannot scroll in agent tmux window","description":"User unable to scroll in the tmux window when running agent-relay wrapped agents. Need to fix mouse scroll or keyboard scroll behavior.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T15:01:55.791186+01:00","updated_at":"2025-12-23T15:04:51.896303+01:00","closed_at":"2025-12-23T15:04:51.896303+01:00"}
{"id":"agent-relay-b919","title":"Fix Cmd+N spawn shortcut conflict","description":"Cmd+N shortcut for spawning agents has a conflict that needs to be resolved","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-28T22:08:23.539814-05:00","updated_at":"2025-12-28T22:09:20.683421-05:00","closed_at":"2025-12-28T22:09:20.683421-05:00","close_reason":"Fixed by Frontend - changed shortcut to Cmd+Shift+S with keyboard handler"}
{"id":"agent-relay-bai","title":"Fix bridge reconnection loop caused by agent name conflict","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-25T13:26:46.025963+01:00","updated_at":"2025-12-25T13:27:04.323001+01:00","closed_at":"2025-12-25T13:27:04.323001+01:00"}
{"id":"agent-relay-bd0","title":"Consolidate team-* commands under team subcommand","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T21:59:54.102815+01:00","updated_at":"2025-12-19T22:06:16.220013+01:00","closed_at":"2025-12-19T22:06:16.220013+01:00"}
{"id":"agent-relay-bei","title":"Gemini (CleverBeacon) bash syntax errors - unexpected EOF","description":"Gemini agent gets bash errors: 'unexpected EOF while looking for matching quote' and 'syntax error: unexpected end of file' when running shell commands. Possibly related to quote escaping in the relay wrapper.","status":"closed","priority":2,"issue_type":"bug","assignee":"GraniteElk","created_at":"2025-12-19T23:40:36.464079+01:00","updated_at":"2025-12-19T23:45:46.05609+01:00","closed_at":"2025-12-19T23:45:46.05609+01:00"}
{"id":"agent-relay-blj","title":"Add metrics and observability endpoint","description":"Add metrics collection and observability for production monitoring. Include: message throughput, agent health, latency percentiles, error rates, queue depths. Expose via HTTP endpoint (Prometheus format) and/or dashboard integration. Currently flying blind in production.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-23T17:03:41.964359+01:00","updated_at":"2025-12-25T13:33:56.132695+01:00","closed_at":"2025-12-25T13:33:56.132695+01:00"}
{"id":"agent-relay-bx0","title":"Filter stale/internal agents from agents list","description":"agent-relay agents shows __status__ and cli agents which are temporary internal connections. Should filter these out by default, with --all flag to show everything.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-22T15:44:51.944084+01:00","updated_at":"2025-12-22T15:45:44.262049+01:00","closed_at":"2025-12-22T15:45:44.262049+01:00"}
{"id":"agent-relay-coh","title":"Add tests for heartbeat timeout behavior","description":"The heartbeat timeout fix (10s-\u003e30s) was made but no new tests were added. Add unit tests for: 1) configurable heartbeatTimeoutMultiplier, 2) connection survives slow pong responses, 3) connection dies after timeout exceeded.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T23:10:18.599194+01:00","updated_at":"2025-12-25T13:31:23.910414+01:00","closed_at":"2025-12-25T13:31:23.910414+01:00"}
{"id":"agent-relay-cuer","title":"Single agent flickering between active/inactive on dashboard","description":"When a single agent is spawned, the dashboard flickers rapidly between showing the agent as active and inactive. This blocks reliable agent monitoring. Need to investigate: (1) WebSocket connection stability, (2) Status update frequency, (3) State sync race conditions.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T16:53:20.385225+01:00","updated_at":"2025-12-26T17:20:58.613208+01:00","closed_at":"2025-12-26T17:20:58.613208+01:00"}
{"id":"agent-relay-cw8","title":"Add procedural memory for learned patterns","description":"Implement procedural memory system (like ACFS's cass-memory) to store learned patterns and successful approaches. Agents can query 'how did we solve X before?' Enable cross-session learning and pattern reuse.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-23T17:05:14.667585+01:00","updated_at":"2025-12-23T17:05:14.667585+01:00"}
{"id":"agent-relay-d07","title":"Message metadata: subject/thread/importance/replyTo","description":"Add first-class metadata fields to messages (subject, threadId, importance, ackRequired, replyTo/correlationId). Carry them via SendPayload.data and/or [[RELAY]] blocks; persist in storage; update injection formatting + dashboard filters.","acceptance_criteria":"- Can send/receive messages with threadId + importance\\n- Dashboard can filter/group by threadId\\n- Injection shows importance/thread hint without breaking TUIs","notes":"SecondLead: Implemented thread support end-to-end. SendMeta added to client.sendMessage(). tmux-wrapper converts ParsedMessageMetadata to SendMeta. Injection shows [thread:xxx] hint. Dashboard displays thread badge. REMAINING: importance field requires protocol update - DeliverEnvelope needs payload_meta to carry importance through to receivers.","status":"closed","priority":2,"issue_type":"task","assignee":"SecondLead","created_at":"2025-12-20T21:44:18.094598+01:00","updated_at":"2025-12-22T17:15:37.261368+01:00","closed_at":"2025-12-22T17:15:37.261368+01:00","labels":["protocol","ux"]}
{"id":"agent-relay-d2f","title":"Add optional Git audit trail","description":"Commit messages to .agent-relay/messages/ directory. Recoverable history, compliance-friendly.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-20T21:36:19.689795+01:00","updated_at":"2025-12-20T21:36:19.689795+01:00"}
{"id":"agent-relay-d5vn","title":"Add ability to kill spawned agents from dashboard","description":"Currently there is no way to kill/terminate a spawned agent from the dashboard UI. Need to add a kill/terminate button or action for spawned agents.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T22:11:48.358972-05:00","updated_at":"2025-12-29T15:31:48.126836-05:00","closed_at":"2025-12-29T15:26:08.567794-05:00"}
{"id":"agent-relay-dd8","title":"Add file reservation system (from mcp_agent_mail)","description":"Advisory locks with TTL, @relay:lock pattern, pre-commit hook integration. Critical for multi-agent file editing.","notes":"No progress today; added as future work from swarm-mail comparison: implement reservations/locks with TTL + conflict detection. See swarm-mail reservations + locks patterns.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-20T21:36:19.573504+01:00","updated_at":"2025-12-20T22:00:37.608017+01:00"}
{"id":"agent-relay-dkx","title":"Add metrics dashboard for system health monitoring","description":"Track agent metrics (throughput, uptime, online status), session lifecycle (active/closed/error rates), and per-agent message counts. Provide Prometheus-format export for monitoring integration. Includes metrics.ts utilities and metrics.html dashboard page.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-25T14:07:28.416696+01:00","updated_at":"2025-12-26T11:41:20.321264+01:00","closed_at":"2025-12-26T11:41:20.321264+01:00"}
{"id":"agent-relay-dyr","title":"No authentication between agents","description":"Any process can connect to the daemon socket and impersonate any agent name. Consider: (1) Per-agent tokens/secrets, (2) Socket permission checks, (3) Optional TLS for non-localhost deployments.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-20T00:18:16.215889+01:00","updated_at":"2025-12-20T00:18:16.215889+01:00"}
{"id":"agent-relay-eek","title":"Change relay prefix from @relay to \u003e\u003erelay","description":"Unify the relay protocol prefix to \u003e\u003erelay (instead of @relay) so it works for all agents including Gemini. Update parser, documentation, and any hardcoded references.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T12:20:35.35848+01:00","updated_at":"2025-12-22T12:30:21.696239+01:00","closed_at":"2025-12-22T12:30:21.696239+01:00"}
{"id":"agent-relay-ekk9","title":"Add @-mention autocomplete to v2 message composer","description":"V1 dashboard has @-mention autocomplete in the message composer. When typing @A, it shows a dropdown with matching agents (@Alice, @Admin, etc.). V2's MessageComposer lacks this feature. Need to port the autocomplete logic from v1's components.ts (showMentionAutocomplete, completeMention functions) to v2.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-27T05:36:28.283162+01:00","updated_at":"2025-12-27T05:44:05.597544+01:00","closed_at":"2025-12-27T05:44:05.597544+01:00","close_reason":"Added missing mention-autocomplete CSS styles to globals.css"}
{"id":"agent-relay-ex7","title":"Competitive analysis: Agent-to-agent messaging solutions","description":"Research and compare 17 multi-agent orchestration tools against agent-relay. Analyze: agent communication patterns, pros/cons, server/mobile support, memory architecture.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T16:34:31.174109+01:00","updated_at":"2025-12-23T16:55:19.264056+01:00","closed_at":"2025-12-23T16:55:19.264056+01:00"}
{"id":"agent-relay-ey9","title":"Dashboard message sending not working","description":"User reports sending messages from dashboard doesn't work. Need to investigate.","status":"closed","priority":2,"issue_type":"bug","assignee":"SecondLead","created_at":"2025-12-22T15:54:48.975146+01:00","updated_at":"2025-12-22T17:07:48.705786+01:00","closed_at":"2025-12-22T17:07:48.705786+01:00"}
{"id":"agent-relay-f3q","title":"Make msg-read a subcommand of send or message","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T21:59:55.123772+01:00","updated_at":"2025-12-19T22:04:51.112763+01:00","closed_at":"2025-12-19T22:04:51.112763+01:00"}
{"id":"agent-relay-f9k","title":"Fix WebSocket Invalid frame header error","description":"Dashboard WebSocket throws Invalid frame header with 415KB payload. Missing wss.on('connection') handler causes race condition.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T17:17:26.412812+01:00","updated_at":"2025-12-23T17:18:30.4994+01:00","closed_at":"2025-12-23T17:18:30.4994+01:00"}
{"id":"agent-relay-fb3","title":"Add configurable relay prefix for Gemini compatibility","description":"Gemini CLI uses @ for file references, conflicting with @relay:. Add --prefix flag to CLI and relayPrefix config option. Auto-detect CLI type and use appropriate default (\u003e\u003e for Gemini, @relay: for Claude/Codex). Update parser to use dynamic prefix. See docs/TMUX_IMPROVEMENTS.md for full implementation plan.","status":"closed","priority":2,"issue_type":"feature","assignee":"Coordinator","created_at":"2025-12-20T21:28:52.685002+01:00","updated_at":"2025-12-20T21:40:13.066766+01:00","closed_at":"2025-12-20T21:40:13.066766+01:00"}
{"id":"agent-relay-fuob","title":"Fix spawner tests for resolved tmux path","description":"Update src/bridge/spawner.test.ts mocks to expect resolved tmux binary path (e.g., \"/opt/homebrew/bin/tmux\") instead of just \"tmux\". 9 tests failing due to exact command string assertions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T19:28:46.381693-05:00","updated_at":"2025-12-28T19:32:17.034494-05:00","closed_at":"2025-12-28T19:32:17.034494-05:00","close_reason":"Tests updated to mock tmux-resolver - all 514 tests pass"}
{"id":"agent-relay-ghy","title":"Team config: auto-spawn agents or auto-assign names from teams.json","description":"When a project has a teams.json config file, agent-relay up should either:\n\n1. **Auto-spawn option**: Automatically kick off terminal sessions for each agent defined in teams.json\n2. **Auto-assign option**: When users manually start sessions with `agent-relay -n \u003cname\u003e claude`, validate the name against teams.json and auto-assign roles/permissions\n\n## teams.json format\n```json\n{\n  \"team\": \"my-project\",\n  \"agents\": [\n    {\"name\": \"Coordinator\", \"cli\": \"claude\", \"role\": \"coordinator\"},\n    {\"name\": \"LeadDev\", \"cli\": \"claude\", \"role\": \"developer\"},\n    {\"name\": \"Reviewer\", \"cli\": \"claude\", \"role\": \"reviewer\"}\n  ],\n  \"autoSpawn\": false\n}\n```\n\n## Behavior\n- If `autoSpawn: true`, `agent-relay up` spawns tmux sessions for each agent\n- If `autoSpawn: false`, validate names against config when agents connect\n- Store teams.json in project root or .agent-relay/teams.json\n\n## Commands\n- `agent-relay up --spawn` - force spawn all agents\n- `agent-relay up --no-spawn` - just start daemon, manual agent starts","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-19T23:13:02.482971+01:00","updated_at":"2025-12-22T22:11:38.639588+01:00"}
{"id":"agent-relay-go9","title":"PostgreSQL storage adapter not implemented","description":"In storage/adapter.ts:152-162, PostgreSQL is listed as a storage option but throws 'not yet implemented'. For production multi-node deployments, SQLite won't scale. Implement PostgreSQL adapter for distributed storage.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-20T00:17:45.065487+01:00","updated_at":"2025-12-20T00:17:45.065487+01:00"}
{"id":"agent-relay-hgd","title":"Reliable delivery: resume/replay via cursor/checkpoint","description":"Make ACK/RESUME real: persist a per-agent delivery cursor (last delivered/acked seq) and on reconnect replay missed messages from storage. Use existing delivery.seq as stream position, similar to swarm-mail DurableCursor checkpointing.","acceptance_criteria":"- Client can reconnect and receive missed messages\\n- Duplicate suppression is deterministic (id/seq based)\\n- Cursor persists across daemon restarts","notes":"Persistent resume tokens with stored cursors; replay unacked messages on reconnect; ack tracking + dedup; tests passing.","status":"closed","priority":1,"issue_type":"task","assignee":"BE-Dev","created_at":"2025-12-20T21:44:02.016428+01:00","updated_at":"2025-12-29T15:31:48.127373-05:00","closed_at":"2025-12-29T15:26:08.592051-05:00","labels":["durability","protocol"]}
{"id":"agent-relay-hgn","title":"Agent team hierarchies with specialized sub-agents","description":"Each main agent should be able to spawn and coordinate a team of specialized sub-agents:\n\n- **Lead** â†’ Operations Consultant (monitors behavior, provides retrospective feedback on coordination)\n- **Implementer** â†’ Code Reviewer (reviews code before commits, suggests improvements)\n- **Designer** â†’ UX Reviewer (validates design decisions)\n- **Architect** â†’ Security Auditor (checks for vulnerabilities)\n\nImplementation ideas:\n1. Define agent profiles with 'team' configurations in .claude/agents/\n2. When an agent starts, it can auto-spawn its team members\n3. Sub-agents monitor the parent agent's work and provide feedback\n4. At session end, sub-agents provide retrospective summaries\n5. Use -\u003erelay:spawn to create sub-agents with specific roles\n\nThis enables each agent to have a dedicated support team for quality assurance and improvement.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-23T15:03:56.608847+01:00","updated_at":"2025-12-23T15:03:56.608847+01:00"}
{"id":"agent-relay-hgw","title":"PR-9 Review: Add reconnection logic to MultiProjectClient","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T21:54:09.712003+01:00","updated_at":"2025-12-24T11:50:55.708361+01:00","closed_at":"2025-12-24T11:50:55.708361+01:00"}
{"id":"agent-relay-hks","title":"Increase test coverage for daemon/server.ts, dashboard, and CLI","description":"Current coverage is only 39% overall. Key files with 0% coverage: daemon/server.ts, dashboard/server.ts, cli/index.ts, wrapper/client.ts, wrapper/tmux-wrapper.ts, utils/project-namespace.ts. Need integration tests for the daemon startup/shutdown lifecycle and CLI commands.","status":"closed","priority":2,"issue_type":"task","assignee":"Lead","created_at":"2025-12-20T00:17:29.603137+01:00","updated_at":"2025-12-22T17:14:41.611717+01:00","closed_at":"2025-12-22T17:14:41.611717+01:00"}
{"id":"agent-relay-hr1","title":"Show project reconnection status in dashboard","description":"Display project connection status (Connected/Reconnecting/Disconnected) in dashboard header. Use onProjectStateChange callbacks from MultiProjectClient to drive 'Connected/Disconnecting' indicators. Show per-project status and overall relay connection health. Color code: green (connected), yellow (reconnecting), red (disconnected).","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T11:51:32.74308+01:00","updated_at":"2025-12-24T11:52:22.778492+01:00","closed_at":"2025-12-24T11:52:22.778492+01:00"}
{"id":"agent-relay-hvm","title":"Dashboard: Add ability to send messages to agents","description":"Add a message compose UI in the dashboard to send messages to any connected agent. Should include: (1) Agent selector dropdown, (2) Message input field, (3) Send button that dispatches via the relay protocol. This complements the existing message viewing capability.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-22T15:31:07.022117+01:00","updated_at":"2025-12-22T15:36:18.78037+01:00","closed_at":"2025-12-22T15:36:18.78037+01:00"}
{"id":"agent-relay-i5f","title":"Fix rendering and display issues","description":"Relay messages display with garbled/overlapping text in terminal. Characters appear scattered and mixed with other terminal content. Example: message text like 'Ping me when you're ready' renders with letters displaced across the line. PR #10 added input detection (isInputClear, waitForClearInput, getCursorX) to prevent this, but it's not working effectively. Need to investigate why the input detection/wait logic isn't preventing message injection during active typing.","notes":"Parser improvements for continuation lines (bullets, numbered lists, box drawing chars for Gemini). Debug flag set to false.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T11:59:53.254169+01:00","updated_at":"2025-12-22T14:21:32.043374+01:00","closed_at":"2025-12-22T14:21:32.043374+01:00","labels":["review"]}
{"id":"agent-relay-i6gt","title":"Debug thinking block filter - tests fail despite correct patterns","notes":"Investigation notes:\n\nWhat was implemented:\n- Added THINKING_START and THINKING_END patterns to parser.ts (lines 69-71)\n- Added inThinkingBlock state variable (line 157)\n- Added detection logic in parsePassThrough (lines 445-465)\n- Added reset logic in flush() and reset() methods\n\nThe problem:\nTests show the thinking block content is NOT being filtered - it passes through to output.\nThe patterns match correctly when tested standalone in Node.\n\nWhat to investigate:\n1. The check is at lines 456-465 in parser.ts - why doesn't it match at runtime?\n2. Could be an issue with how the for loop flows or where the check is placed\n3. Try adding console.log in the detection code to trace execution\n4. The compiled code at dist/wrapper/parser.js lines 380-390 looks correct\n\nFiles modified:\n- src/wrapper/parser.ts - thinking block filter implementation\n- Tests were written but reverted (failing)","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-27T11:42:23.020797+01:00","updated_at":"2025-12-27T11:42:44.912268+01:00"}
{"id":"agent-relay-i7s","title":"Add priority-based message queuing","description":"Implement message priority levels (urgent/high/normal/low) like AI Maestro. Urgent messages jump the queue and interrupt agents. Enables time-sensitive coordination in production scenarios.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-23T17:04:48.031237+01:00","updated_at":"2025-12-23T17:04:48.031237+01:00"}
{"id":"agent-relay-iblw","title":"Allow agents to spawn other agents via agent-relay API","description":"Agents should be able to spawn new agent processes programmatically via agent-relay API. Enables dynamic team scaling and parallel agent coordination. Implement: (1) Agent spawn endpoint, (2) API wrapper for agent code, (3) Spawn coordination, (4) Resource limits, (5) Tests.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-26T17:08:22.05611+01:00","updated_at":"2025-12-26T17:08:22.05611+01:00"}
{"id":"agent-relay-iic5","title":"Multi-line relay messages truncated in dashboard UI (regression)","description":"Multi-line relay messages are only displaying the first line in the dashboard UI, even though the parser is capturing all lines. Root cause investigation needed: (1) Dashboard rendering (may be truncating display), (2) WebSocket message transmission, (3) Message state management. Previously marked as fixed but still broken.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-26T17:05:33.146646+01:00","updated_at":"2025-12-26T17:20:58.611383+01:00","closed_at":"2025-12-26T17:20:58.611383+01:00"}
{"id":"agent-relay-j7y","title":"Implement composer toolbar buttons (bold, emoji)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T16:26:23.598781+01:00","updated_at":"2025-12-23T16:27:53.92751+01:00","closed_at":"2025-12-23T16:27:53.92751+01:00"}
{"id":"agent-relay-j9z","title":"Message injection corrupts human input in progress","description":"When a relay message arrives while the human is actively typing, the injection (Esc + Ctrl-U + message + Enter) destroys their partial input. Need to detect active input state before injecting. Options: (1) Check tmux pane input buffer, (2) Queue messages until prompt detected, (3) Use tmux display-message instead of send-keys for non-intrusive notification, (4) Add visual indicator that message is pending.","design":"Mitigation ideas: 1) Prefer tmux non-intrusive notify: tmux display-message (and always write to inbox/storage) instead of send-keys when user is typing. 2) Gate send-keys injection on 'safe' state: pane idle AND prompt detected AND no partial input; otherwise queue. 3) If queued, show pending count via display-message.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-20T21:48:03.280298+01:00","updated_at":"2025-12-20T22:00:04.196161+01:00","dependencies":[{"issue_id":"agent-relay-j9z","depends_on_id":"agent-relay-6rz","type":"blocks","created_at":"2025-12-20T21:48:10.118963+01:00","created_by":"daemon","metadata":"{}"}]}
{"id":"agent-relay-jmwh","title":"Bundle tmux or provide fallback so users don't need to install separately","description":"User installation failed: tmux command not found. Currently agent-relay requires tmux to be pre-installed on the system. Need to bundle tmux or provide a fallback so installation works out-of-the-box.\n\nOptions to explore:\n1. NPM package that includes tmux binaries (npm tmux package or similar)\n2. Postinstall script that downloads/installs tmux\n3. Fallback to alternative shell mechanism if tmux unavailable\n4. Docker-based approach (out of scope but document)\n\nAcceptance: Installation should succeed and agent-relay should work without requiring manual tmux install","status":"closed","priority":0,"issue_type":"feature","assignee":"FullStack","created_at":"2025-12-28T18:51:04.556744-05:00","updated_at":"2025-12-28T19:32:54.921952-05:00","closed_at":"2025-12-28T19:32:54.921952-05:00","close_reason":"Implemented: postinstall script downloads tmux, tmux-resolver provides systemâ†’bundled fallback, all code uses resolved path, tests pass"}
{"id":"agent-relay-k8t","title":"Consider backend-focused agent for daemon work","description":"Session retrospective: only had FE-Dev specialist, so backend work (permission detection, daemon issues) fell to Lead. Consider spawning a dedicated backend agent for daemon/server work in future sessions.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T23:10:24.756163+01:00","updated_at":"2025-12-23T23:10:24.756163+01:00"}
{"id":"agent-relay-kaj","title":"Show project connection status in dashboard (Connected/Reconnecting/Disconnected)","description":"Use onProjectStateChange callbacks from MultiProjectClient to show connection status in dashboard. When onProjectStateChange(id, false) fires, show 'Disconnected' or 'Reconnecting...' indicator. When onProjectStateChange(id, true) fires, show 'Connected'. Could use a status badge in the sidebar or header.","status":"closed","priority":2,"issue_type":"feature","assignee":"FE-Dev","created_at":"2025-12-24T11:51:40.774105+01:00","updated_at":"2025-12-24T11:55:00.944949+01:00","closed_at":"2025-12-24T11:55:00.944949+01:00"}
{"id":"agent-relay-kto","title":"Add topic-based pub/sub messaging","description":"Add topic subscription alongside direct addressing. Agents can subscribe to topics (e.g., 'errors', 'deploys', 'reviews') and receive all messages on those topics. Complements existing -\u003erelay:Name with -\u003erelay:#topic pattern. Pattern from Claude-Flow's message bus.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-23T17:05:27.213842+01:00","updated_at":"2025-12-23T17:05:27.213842+01:00"}
{"id":"agent-relay-kw80","title":"Plan and execute Dashboard v1 â†’ v2 migration","description":"## Dashboard v1 â†’ v2 Migration Plan\n\n### Feature Parity Analysis (COMPLETED)\n\n**V1 Features in V2:** âœ… ALL FEATURES PORTED\n- Agent list with online/offline status\n- Message list with date dividers  \n- Channel selection (general + DMs)\n- Command palette (Cmd+K)\n- Spawn agent modal\n- Thread support\n- Fleet view (multi-server)\n- Release agent button\n- Needs attention badge\n- âœ… @-mention autocomplete (agent-relay-ekk9 - DONE)\n\n**V2-Only Features (Enhancements):**\n- Theme support (light/dark/system)\n- Settings panel\n- Trajectory viewer\n- Decision queue\n- Enhanced broadcast composer with templates\n- Notification toasts\n\n### Migration Steps\n\n1. **[agent-relay-lls5]** Configure parallel running (v1:4280, v2:4281) - READY\n2. **[agent-relay-s8hg]** Add --dashboard=v1|v2 CLI flag - blocked by lls5\n3. ~~**[agent-relay-ekk9]** Fix @-mention autocomplete~~ âœ… DONE\n4. **[agent-relay-qkey]** Switch default to v2 - blocked by s8hg\n\n### Rollback Procedure\n\n1. Use `agent-relay up --dashboard=v1` to revert instantly\n2. V1 code remains in place until v2 is stable\n3. No data migration needed - both share same backend/storage","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-26T17:01:58.36924+01:00","updated_at":"2025-12-29T01:52:36.152813-05:00","closed_at":"2025-12-29T05:46:32.847338602Z","dependencies":[{"issue_id":"agent-relay-kw80","depends_on_id":"agent-relay-cuer","type":"blocks","created_at":"2025-12-26T17:02:04.103774+01:00","created_by":"daemon","metadata":"{}"},{"issue_id":"agent-relay-kw80","depends_on_id":"agent-relay-ekk9","type":"blocks","created_at":"2025-12-27T05:36:37.645846+01:00","created_by":"daemon"}]}
{"id":"agent-relay-kzw","title":"Project namespace uses /tmp which can be cleared on reboot","description":"In utils/project-namespace.ts:13, BASE_DIR is /tmp/agent-relay. On macOS/Linux, /tmp is cleared on reboot, losing all message history. Consider: (1) XDG_DATA_HOME fallback, (2) ~/.agent-relay option, (3) Per-project .agent-relay folder.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T00:18:33.224965+01:00","updated_at":"2025-12-20T00:18:33.224965+01:00"}
{"id":"agent-relay-l99","title":"Add output filtering for cleaner logs","description":"Filter noisy patterns from logs: thinking indicators [1/418], empty ANSI-only lines, etc. Add config.filterLogs option. See docs/TMUX_IMPROVEMENTS.md for implementation details.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-20T21:28:51.199736+01:00","updated_at":"2025-12-20T21:28:51.199736+01:00","dependencies":[{"issue_id":"agent-relay-l99","depends_on_id":"agent-relay-1ek","type":"blocks","created_at":"2025-12-20T21:29:26.987526+01:00","created_by":"daemon","metadata":"{}"}]}
{"id":"agent-relay-lfky","title":"Add 'agent thinking/processing' indicator to dashboard","description":"When an agent receives a message, the dashboard should show a visual indicator that the agent is processing/thinking. Similar to 'typing...' indicators in chat apps.\n\n**Requirements:**\n1. Backend: Track agent status (idle/processing/responding)\n2. Protocol: Agents report when they start/finish processing a message\n3. Dashboard UI: Show pulsing/animated indicator next to agent when processing\n4. Timeout: Auto-clear indicator if no response after X seconds\n\n**Implementation options:**\n- Agents send STATUS: PROCESSING / STATUS: IDLE messages\n- Or use heartbeat with embedded state\n- Or infer from message timestamps (less reliable)\n\nRequested by: Dashboard agent during v1â†’v2 migration planning","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-27T05:38:19.022332+01:00","updated_at":"2025-12-27T10:59:41.070383+01:00","closed_at":"2025-12-27T10:59:41.070383+01:00","close_reason":"Processing indicator implementation complete with router tracking and dashboard color support"}
{"id":"agent-relay-lls5","title":"Configure daemon to serve v2 dashboard on alt port","description":"Add daemon configuration to serve v2 dashboard (Next.js) on port 4281 while keeping v1 on 4280. This enables parallel running during migration period.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T05:36:49.475705+01:00","updated_at":"2025-12-29T01:52:36.153625-05:00","closed_at":"2025-12-29T05:47:40.979797502Z"}
{"id":"agent-relay-lto","title":"Command palette channel/chat selection","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-23T16:15:32.818842+01:00","updated_at":"2025-12-23T16:18:00.952354+01:00","closed_at":"2025-12-23T16:18:00.952354+01:00"}
{"id":"agent-relay-mcl","title":"Gemini agent cannot send messages properly","description":"Gemini agent cannot autonomously send relay messages. When Gemini outputs @relay: patterns, it enters shell mode instead of being intercepted by the relay wrapper. Manual typing works fine. This suggests a PTY parsing issue specific to how Gemini outputs the @relay: pattern - possibly timing, escaping, or output buffering differences compared to Claude.","status":"closed","priority":2,"issue_type":"bug","assignee":"LeadDev","created_at":"2025-12-20T00:29:15.797552+01:00","updated_at":"2025-12-20T21:56:07.20143+01:00","closed_at":"2025-12-20T21:56:07.20143+01:00"}
{"id":"agent-relay-mkz","title":"Fix multi-line message display in dashboard","description":"Multi-line messages are not displaying properly in the dashboard UI. This is a critical UX issue affecting message readability. Need to fix the frontend rendering of message content to properly handle newlines, formatting, and multi-line text.","status":"closed","priority":1,"issue_type":"bug","assignee":"Frontend","created_at":"2025-12-25T14:11:25.663841+01:00","updated_at":"2025-12-26T11:51:07.14395+01:00","closed_at":"2025-12-26T11:51:07.14395+01:00"}
{"id":"agent-relay-mplo","title":"Parser: Fix overcapturing text in multi-line relay messages","description":"Recent parser improvements (agent-relay-6dl8 fix) are still overcapturing text in multi-line relay messages. Dashboard reports text is being included beyond message boundaries. Need to review parser.ts finishBlock() and handle parsing edge cases.","status":"closed","priority":1,"issue_type":"bug","assignee":"FullStack","created_at":"2025-12-26T21:06:42.006611+01:00","updated_at":"2025-12-27T05:43:25.432704+01:00","closed_at":"2025-12-27T05:43:25.432704+01:00","close_reason":"Fixed: Reverted parser to simpler logic - inline messages are single-line only, only indented lines continue (TUI wrapping). Multi-line messages should use [[RELAY]] block format."}
{"id":"agent-relay-n36","title":"Add metrics dashboard for system health monitoring","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-25T14:07:36.499133+01:00","updated_at":"2025-12-26T11:41:20.33149+01:00","closed_at":"2025-12-26T11:41:20.33149+01:00"}
{"id":"agent-relay-nox","title":"Dashboard not showing live agents or messages","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T12:11:48.614811+01:00","updated_at":"2025-12-23T12:26:51.322956+01:00","closed_at":"2025-12-23T12:26:51.322956+01:00"}
{"id":"agent-relay-oiw","title":"BUG: No per-agent inbox files created","description":"Expected /tmp/agent-relay/\u003cproject\u003e/\u003cagent\u003e/inbox.md but only team/agents.json exists. Agents cannot read their inbox via file.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-20T21:46:24.826442+01:00","updated_at":"2025-12-22T14:29:46.830632+01:00","closed_at":"2025-12-22T14:29:46.830632+01:00"}
{"id":"agent-relay-p0k","title":"Gemini agents cannot send relay messages","description":"Gem (Gemini CLI) can receive messages but cannot send them. Tried: -\u003erelay:, \u003e\u003erelay:, escaping with backticks, splitting lines. Messages don't get captured/sent. Possibly Gemini CLI output handling differs from Claude/Codex. Need to investigate how Gemini outputs text and whether the tmux capture-pane is picking it up correctly.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T13:52:43.407612+01:00","updated_at":"2025-12-22T13:55:11.068344+01:00","closed_at":"2025-12-22T13:55:11.068344+01:00"}
{"id":"agent-relay-pu6h","title":"Align metrics page styling with dashboard","description":"The metrics page styling is completely different from the main dashboard. Need to update it to match the dashboard's look and feel.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T22:09:13.958899-05:00","updated_at":"2025-12-28T22:13:36.714948-05:00","closed_at":"2025-12-28T22:13:36.714948-05:00","close_reason":"Fixed by Frontend - updated colors, fonts, removed sci-fi effects to match dashboard"}
{"id":"agent-relay-pvx","title":"Dashboard agent detection debugging","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T17:14:36.376736+01:00","updated_at":"2025-12-23T17:16:13.115531+01:00","closed_at":"2025-12-23T17:16:13.115531+01:00"}
{"id":"agent-relay-qg4e","title":"Fix line break display in dashboard messages","description":"Line breaks in messages display as extra spaces instead of actual line breaks. Messages should render with proper newlines.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-28T22:09:53.92514-05:00","updated_at":"2025-12-28T22:11:31.098231-05:00","closed_at":"2025-12-28T22:11:31.098231-05:00","close_reason":"Fixed by Frontend - added normalization for literal \\n strings, \\r\\n, and \\r"}
{"id":"agent-relay-qkey","title":"Switch default dashboard to v2","description":"After feature parity is verified and parallel running period is complete, switch the default dashboard from v1 to v2. Update agent-relay up command to serve v2 by default.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-27T05:36:52.036031+01:00","updated_at":"2025-12-29T01:52:36.154125-05:00","closed_at":"2025-12-29T05:47:57.245409495Z","dependencies":[{"issue_id":"agent-relay-qkey","depends_on_id":"agent-relay-s8hg","type":"blocks","created_at":"2025-12-27T05:37:00.746565+01:00","created_by":"daemon"},{"issue_id":"agent-relay-qkey","depends_on_id":"agent-relay-ekk9","type":"blocks","created_at":"2025-12-27T05:37:00.817799+01:00","created_by":"daemon"}]}
{"id":"agent-relay-rm7","title":"Add scheduling strategies for task distribution","description":"Implement scheduling strategies for distributing tasks across agents. Start with round-robin, then add capability-based, least-loaded, and affinity strategies. Inspired by Claude-Flow's 4-strategy approach. Enables autonomous task assignment instead of manual coordination.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-23T17:03:22.014068+01:00","updated_at":"2025-12-23T17:03:22.014068+01:00"}
{"id":"agent-relay-ruv","title":"Add work stealing for load balancing","description":"Implement work stealing so idle agents can claim tasks from overloaded peers. Key production feature for better resource utilization. Pattern from Claude-Flow's WorkStealingCoordinator. Requires task queue visibility and agent load metrics.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-23T17:03:28.153623+01:00","updated_at":"2025-12-23T17:03:28.153623+01:00"}
{"id":"agent-relay-s8hg","title":"Add dashboard version switch to CLI","description":"Add --dashboard=v1|v2 flag to agent-relay up command to choose which dashboard version to run. Default should remain v1 until migration is complete.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T05:36:51.0113+01:00","updated_at":"2025-12-29T01:52:36.154656-05:00","closed_at":"2025-12-29T05:47:41.00431035Z","dependencies":[{"issue_id":"agent-relay-s8hg","depends_on_id":"agent-relay-lls5","type":"blocks","created_at":"2025-12-27T05:37:00.684918+01:00","created_by":"daemon"}]}
{"id":"agent-relay-sio","title":"Add graceful degradation when relay daemon is unavailable","description":"In wrapper/tmux-wrapper.ts:195-197, daemon connection failures are silently caught. Consider: (1) Periodic reconnection attempts, (2) Queueing messages for later delivery, (3) Visual indicator in terminal showing connection status.","status":"closed","priority":2,"issue_type":"feature","assignee":"Implementer","created_at":"2025-12-20T00:17:32.600333+01:00","updated_at":"2025-12-22T17:12:29.892345+01:00","closed_at":"2025-12-22T17:12:29.892345+01:00"}
{"id":"agent-relay-t4b","title":"Add spawn agent UI to dashboard","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-25T13:20:54.452959+01:00","updated_at":"2025-12-25T13:25:05.019339+01:00","closed_at":"2025-12-25T13:25:05.019339+01:00"}
{"id":"agent-relay-tun","title":"Debug output leaking to terminal during relay message send","description":"When sending relay messages (observed with relay:Gem), debug output is leaking to the terminal repeatedly. Output shows: 'relay:Gem] isInputClear: lastLine=\"\" ~/.../agent-relay (main*)' and 'ear=false' (truncated 'isInputClear=false'). Lines are split/corrupted and repeating in a loop. Likely issue in the tmux wrapper or message injection code where debug logging isn't being suppressed properly.","status":"closed","priority":1,"issue_type":"bug","assignee":"Lead","created_at":"2025-12-22T13:40:28.576361+01:00","updated_at":"2025-12-22T13:42:16.746166+01:00","closed_at":"2025-12-22T13:42:16.746166+01:00"}
{"id":"agent-relay-tx9","title":"Add circuit breaker for unresponsive agents","description":"Implement circuit breaker pattern to handle unresponsive or failing agents. Auto-detect agents that stop responding, temporarily remove from routing, attempt recovery, alert on persistent failures. Prevents cascade failures in production. Pattern from Claude-Flow's CircuitBreakerManager.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-23T17:03:48.162055+01:00","updated_at":"2025-12-23T17:03:48.162055+01:00"}
{"id":"agent-relay-u2z","title":"Add @-mention autocomplete with Tab in dashboard chat input","description":"When a user types '@' in the dashboard chat input, show a dropdown of available/connected agents. Tab key should autocomplete the selected agent name. This enables easy @-mentioning of agents for direct messages.","status":"closed","priority":1,"issue_type":"feature","assignee":"FE-Dev","created_at":"2025-12-23T22:52:34.749062+01:00","updated_at":"2025-12-23T22:57:11.634365+01:00","closed_at":"2025-12-23T22:57:11.634365+01:00"}
{"id":"agent-relay-ucw","title":"Dashboard: multi-project navigation or dynamic port allocation","description":"When the dashboard is already running for one project, users should be able to either: (1) Navigate between different projects in a single dashboard view, OR (2) Start a new dashboard instance on an automatically allocated available port for a different project. Currently if a dashboard is running, starting another project conflicts.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-19T23:40:18.667766+01:00","updated_at":"2025-12-20T00:18:05.10495+01:00","closed_at":"2025-12-20T00:18:05.10495+01:00"}
{"id":"agent-relay-ude","title":"Complete agent-relay-90h backend: detect when agents need input","description":"Frontend for permission indicator is done (needsAttention field, pulsing indicator, badge). Backend needs to detect when agents are waiting for permissions/input and set the needsAttention flag. Could monitor stdin, parse terminal output for permission prompts, or have agents send explicit STATUS messages.","status":"closed","priority":1,"issue_type":"task","assignee":"BE-Dev","created_at":"2025-12-23T23:10:06.438813+01:00","updated_at":"2025-12-24T11:48:43.798848+01:00","closed_at":"2025-12-24T11:48:43.798848+01:00"}
{"id":"agent-relay-ujq","title":"Add @-mention autocomplete in chat input","description":"When typing @ in the chat input, show autocomplete dropdown with available agent names. Tab to complete selection, arrow keys to navigate through options. Should filter as user types after @.","status":"closed","priority":1,"issue_type":"feature","assignee":"FE-Dev","created_at":"2025-12-24T08:01:03.793267+01:00","updated_at":"2025-12-24T08:02:51.638981+01:00","closed_at":"2025-12-24T08:02:51.638981+01:00"}
{"id":"agent-relay-v57","title":"No message expiration/cleanup in SQLite storage","description":"SQLite adapter has no TTL or cleanup mechanism for old messages. Over time, the database will grow unbounded. Add: (1) Configurable message retention period, (2) Automatic cleanup job, (3) Index on ts column is there but no cleanup uses it.","status":"closed","priority":2,"issue_type":"task","assignee":"Lead","created_at":"2025-12-20T00:18:01.86766+01:00","updated_at":"2025-12-22T17:17:41.867951+01:00","closed_at":"2025-12-22T17:17:41.867951+01:00"}
{"id":"agent-relay-v7f","title":"Add conflict detection and resolution","description":"Implement conflict detection when multiple agents work on same files/resources. Add resolution strategies: priority-based, timestamp-based, voting-based. Prevents race conditions in production. Pattern from Claude-Flow's ConflictResolver and OptimisticLockManager.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-23T17:03:34.498546+01:00","updated_at":"2025-12-23T17:03:34.498546+01:00"}
{"id":"agent-relay-v9rc","title":"Fix light/dark mode toggle in settings","description":"The light mode / dark mode switch from the settings panel doesn't work","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-28T22:05:41.332721-05:00","updated_at":"2025-12-28T22:08:21.904724-05:00","closed_at":"2025-12-28T22:08:21.904724-05:00","close_reason":"Fixed by Frontend - added light theme CSS variables and useEffect for data-theme attribute"}
{"id":"agent-relay-vxc","title":"Navigation consistency between bridge and project views","description":"Ensure navigation patterns are consistent when switching between bridge and project dashboard views","status":"closed","priority":2,"issue_type":"task","assignee":"FE-Dev","created_at":"2025-12-24T11:47:46.62539+01:00","updated_at":"2025-12-24T12:00:15.805473+01:00","closed_at":"2025-12-24T12:00:15.805473+01:00"}
{"id":"agent-relay-wsd","title":"URGENT: Gemini interprets relay messages as shell commands","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-22T14:23:05.989732+01:00","updated_at":"2025-12-22T14:24:18.714626+01:00","closed_at":"2025-12-22T14:24:18.714626+01:00"}
{"id":"agent-relay-xn1","title":"Add remote access via Cloudflare tunnels","description":"Enable remote/mobile access to agent-relay dashboard and control. Use Cloudflare tunnels (like Maestro) for secure access without port forwarding. Include QR code generation for easy mobile connection. Major gap vs competitors - AI Maestro and Maestro both have this.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-23T17:04:28.788302+01:00","updated_at":"2025-12-23T17:04:28.788302+01:00"}
{"id":"agent-relay-ylf","title":"Add knowledge graph for persistent memory","description":"Implement knowledge graph storage (like Mimir's Neo4j approach) for persistent cross-session context. Store entities, relationships, and semantic embeddings. Enable agents to learn from past sessions and share knowledge. Could use SQLite with FTS5 or optional Neo4j adapter.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-23T17:05:08.367875+01:00","updated_at":"2025-12-23T17:05:08.367875+01:00"}
{"id":"agent-relay-ytj","title":"Filter chat view to show only messages with selected agent","description":"When clicking on a particular agent in the dashboard sidebar, the chat view should filter to only show messages between Dashboard and that specific agent. This provides a focused conversation view instead of showing all messages.","status":"closed","priority":2,"issue_type":"feature","assignee":"FE-Dev","created_at":"2025-12-23T22:53:31.325805+01:00","updated_at":"2025-12-23T22:58:41.407339+01:00","closed_at":"2025-12-23T22:58:41.407339+01:00"}
{"id":"agent-relay-ytk","title":"Simplify agent-relay CLI interface","description":"The CLI has too many commands. Consolidate into a clean, simple interface:\n\n1. `relay start` should also kick off the dashboard automatically\n2. Merge redundant team-* commands\n3. Remove rarely-used commands or make them subcommands\n4. Target: 5-7 top-level commands max\n\nCurrent commands to evaluate:\n- start, stop, status (keep)\n- wrap (keep)\n- project (keep or merge into status)\n- send (keep)\n- team-setup, team-status, team-send, team-check, team-listen, team-start (consolidate)\n- msg-read (make subcommand or integrate)\n- dashboard (merge into start)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T21:51:14.010849+01:00","updated_at":"2025-12-22T21:51:14.010849+01:00","closed_at":"2025-12-19T22:08:44.107992+01:00"}
{"id":"agent-relay-ytl","title":"Add cross-project message syntax to parser","description":"Extend the parser (src/wrapper/parser.ts) to recognize @relay:project:agent syntax for cross-project messaging. Currently only @relay:agent is parsed. Need to add pattern matching for the project:agent format.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-21T10:45:00Z","updated_at":"2025-12-24T11:46:51.622328+01:00","closed_at":"2025-12-24T11:46:51.622328+01:00"}
{"id":"agent-relay-ytm","title":"Enhance dashboard for multi-project bridge view","description":"Add a bridge view to the dashboard that shows all connected projects, their leads, workers, and cross-project message flow. Should be accessible at /bridge?projects=... See docs/DESIGN_BRIDGE_STAFFING.md for mockups.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T10:45:00Z","updated_at":"2025-12-22T22:04:18.511591+01:00","closed_at":"2025-12-22T22:04:18.511591+01:00"}
{"id":"agent-relay-ytn","title":"Shadow agent pairing: CLI support","description":"Add --shadow and --shadow-role CLI flags to spawn paired agents. Example: `agent-relay -n Lead --shadow Auditor claude` spawns Lead with an Auditor shadow that observes and provides feedback. The shadow receives all messages the primary sends/receives.","status":"closed","priority":1,"issue_type":"feature","assignee":"Backend","created_at":"2025-12-25T08:00:00Z","updated_at":"2025-12-29T15:31:48.127919-05:00","closed_at":"2025-12-29T15:31:10.671423-05:00","labels":["shadow-agents"]}
{"id":"agent-relay-yto","title":"Shadow agent pairing: Config file support","description":"Support shadow agent configuration in .agent-relay.json. Define pairs (primary-\u003eshadow mappings) and roles (prompt templates like performance-auditor, integration-tester). Config format: { pairs: { Lead: { shadow: 'Auditor', shadowRole: 'performance-auditor' } }, roles: { 'performance-auditor': { prompt: '...', speakOn: ['SESSION_END'] } } }","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-25T08:00:00Z","updated_at":"2025-12-29T15:53:54.085077-05:00","closed_at":"2025-12-29T15:35:56.100259-05:00","labels":["shadow-agents"],"dependencies":[{"issue_id":"agent-relay-yto","depends_on_id":"agent-relay-ytn","type":"blocks","created_at":"2025-12-25T08:00:00Z","created_by":"daemon","metadata":"{}"}]}
{"id":"agent-relay-ytp","title":"Shadow agent pairing: spawnWithShadow() API","description":"Programmatic API for spawning paired agents. Example: `const { primary, shadow } = await spawnWithShadow({ primary: { name: 'Lead', command: 'claude' }, shadow: { name: 'Auditor', role: 'performance-auditor', speakOn: ['SESSION_END'] } })`. Returns handles to both agents for orchestration.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-25T08:00:00Z","updated_at":"2025-12-29T16:11:27.099022-05:00","closed_at":"2025-12-29T15:53:36.751585-05:00","labels":["shadow-agents"],"dependencies":[{"issue_id":"agent-relay-ytp","depends_on_id":"agent-relay-ytn","type":"blocks","created_at":"2025-12-25T08:00:00Z","created_by":"daemon","metadata":"{}"}]}
{"id":"agent-relay-ytq","title":"Shadow agent pairing: Built-in roles","description":"Ship built-in shadow roles: (1) performance-auditor - observes silently, provides feedback at session end; (2) integration-tester - writes tests as primary writes code; (3) code-reviewer - reviews changes before commit; (4) security-auditor - flags security issues in real-time. Roles define prompts and speakOn triggers.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-25T08:00:00Z","updated_at":"2025-12-25T08:00:00Z","labels":["shadow-agents"],"dependencies":[{"issue_id":"agent-relay-ytq","depends_on_id":"agent-relay-yto","type":"blocks","created_at":"2025-12-25T08:00:00Z","created_by":"daemon","metadata":"{}"}]}
{"id":"agent-relay-ytr","title":"Shadow agent pairing: Message routing","description":"Implement shadow message routing: shadows receive copies of all messages their primary sends/receives. Add 'shadow' subscription type in router. Shadows can be configured to speakOn specific triggers (SESSION_END, CODE_WRITTEN, REVIEW_REQUEST) or stay silent until asked.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-25T08:00:00Z","updated_at":"2025-12-29T01:52:36.155128-05:00","closed_at":"2025-12-29T06:22:44.996313457Z","labels":["shadow-agents"]}
{"id":"agent-relay-yts","title":"Wire up spawn/release command handling in lead mode","description":"Lead agents can output @relay:spawn and @relay:release commands, but the handler needs to be wired up to actually call the AgentSpawner. The spawner exists in src/bridge/spawner.ts, need to intercept these commands in the TmuxWrapper or add a message handler.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-21T10:45:00Z","updated_at":"2025-12-24T15:09:22.953849+01:00","closed_at":"2025-12-24T15:09:22.953849+01:00"}
{"id":"agent-relay-ytt","title":"Implement threaded conversations (Slack-style)","description":"Add thread replies with parent_message_id tracking in storage, nested thread UI display in dashboard, thread notification badges, and expand/collapse thread views. Backend: add parent_message_id column, thread reply routing. Frontend: inline thread expansion, reply count badges, thread-specific compose.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-23T12:00:00Z","updated_at":"2025-12-23T16:37:22.987643+01:00","closed_at":"2025-12-23T16:37:22.987643+01:00"}
{"id":"agent-relay-ytu","title":"[Control Plane] Design Control API (REST + WebSocket)","description":"Design API for human control plane: POST /tasks, GET /agents, POST /agents/:id/msg, WS /stream. OpenAPI spec. Authentication endpoints. See ai-maestro's manager/worker pattern for reference.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T14:00:00Z","updated_at":"2025-12-21T14:00:00Z"}
{"id":"agent-relay-ytv","title":"[Control Plane] Implement Lead Agent orchestration","description":"Lead Agent receives human intent, breaks into tasks, assigns to specialized agents based on skills, monitors progress, escalates decisions. Can be AI-powered or rule-based initially.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T14:00:00Z","updated_at":"2025-12-21T14:00:00Z"}
{"id":"agent-relay-ytw","title":"[Control Plane] Build web dashboard v2 (fleet control)","description":"Next.js dashboard with: fleet overview, task assignment UI, agent status cards, trajectory viewer, decision queue. Learn from ai-maestro's hierarchical naming and color coding.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-21T14:00:00Z","updated_at":"2025-12-26T12:39:19.789712+01:00"}
{"id":"agent-relay-ytx","title":"[Control Plane] Human authentication (OAuth/magic link)","description":"Secure human access to control plane. OAuth2 (GitHub/Google) or magic link email auth. JWT tokens for API access. Role-based permissions (admin/operator/viewer).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T14:00:00Z","updated_at":"2025-12-21T14:00:00Z"}
{"id":"agent-relay-yty","title":"[Control Plane] Push notification service","description":"Real-time notifications to mobile/web: APNs for iOS, FCM for Android/web. Notify on: task completion, agent questions, escalations, errors.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T14:00:00Z","updated_at":"2025-12-21T14:00:00Z"}
{"id":"agent-relay-ytz","title":"[Control Plane] iPhone app MVP","description":"React Native or Swift app: fleet status view, task list, agent messaging, push notifications, decision queue with quick actions. Minimal viable version.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T14:00:00Z","updated_at":"2025-12-21T14:00:00Z"}
{"id":"agent-relay-yu0","title":"[Control Plane] Slack/Discord bot integration","description":"Bot for team chat: /fleet status, /assign task agent, @mentions for escalations, threaded replies for agent questions. Webhook-based notifications.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T14:00:00Z","updated_at":"2025-12-21T14:00:00Z"}
{"id":"agent-relay-yu1","title":"[Control Plane] Human escalation queue","description":"Queue for decisions needing human input. Agents can escalate with context. Humans respond via any interface (web/mobile/Slack). Response routed back to agent.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T14:00:00Z","updated_at":"2025-12-21T14:00:00Z"}
{"id":"agent-relay-yu2","title":"[Control Plane] Agent skills registry","description":"Track agent capabilities: skills map (Networkâ†’websocket,tcp,tls), availability, current workload, performance history. Used by Lead Agent for smart assignment.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T14:00:00Z","updated_at":"2025-12-21T14:00:00Z"}
{"id":"agent-relay-yu3","title":"[Control Plane] Code Graph integration","description":"Learn from ai-maestro: visualize codebase as graph (classes, functions, relationships). Delta indexing for performance. Shared context for all agents. Multi-language support.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T14:00:00Z","updated_at":"2025-12-21T14:00:00Z"}
{"id":"agent-relay-yu4","title":"[Control Plane] Agent health monitoring","description":"Like ai-maestro's green/red/yellow status: heartbeat checks, resource usage, error rates, stuck detection. Alert on degradation. Auto-recovery actions.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T14:00:00Z","updated_at":"2025-12-21T14:00:00Z"}
{"id":"agent-relay-yu5","title":"[Control Plane] Agent portability (export/import)","description":"Learn from ai-maestro: export agent as .zip with config, message history, git associations, skills. Import with conflict detection. Enable agent migration between fleets.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T14:00:00Z","updated_at":"2025-12-21T14:00:00Z"}
{"id":"agent-relay-yu6","title":"[Phase 1] Define peer protocol types","description":"Create src/protocol/peer-types.ts with PeerMessageType, PeerEnvelope, PeerHelloPayload, PeerWelcomePayload, PeerSyncPayload, PeerRoutePayload, PeerBroadcastPayload. See FEDERATION_PROPOSAL.md Section 4.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T13:00:00Z"}
{"id":"agent-relay-yu7","title":"[Phase 1] Implement PeerConnection class","description":"Create src/federation/peer-connection.ts. WebSocket connection to single peer with state machine (DISCONNECTEDâ†’CONNECTINGâ†’HANDSHAKINGâ†’ACTIVEâ†’RECONNECTING). Handle HELLO/WELCOME handshake. See FEDERATION_PROPOSAL.md Section 4.6.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yu8","title":"[Phase 1] Implement PeerManager","description":"Create src/federation/peer-manager.ts. Manages multiple PeerConnection instances. Connect to configured peers on daemon start. Handle peer discovery from WELCOME messages.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yu9","title":"[Phase 1] Add peer WebSocket listener to daemon","description":"Extend daemon to listen for incoming peer connections on configurable port (default 8765). Accept connections, perform handshake, register with PeerManager.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yua","title":"[Phase 2] Implement FleetRegistry","description":"Create src/federation/registry.ts with FleetRegistry class. Track agents across fleet with agentToServer mapping. Support fleet-wide unique name enforcement with quorum registration. See FEDERATION_PROPOSAL.md Section 5.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yub","title":"[Phase 2] Implement PEER_SYNC message handling","description":"Handle agent_joined, agent_left, full_sync message types. Update FleetRegistry on sync. Trigger sync on new peer connection and periodically (60s).","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yuc","title":"[Phase 2] Implement name resolution","description":"Add resolve() method to FleetRegistry. Support patterns: Bob (local-first then fleet), Bob@server (explicit), *@server (broadcast to server). See FEDERATION_PROPOSAL.md Section 5.2.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yud","title":"[Phase 2] CLI: agent-relay agents --fleet","description":"Add --fleet flag to agents command. Query FleetRegistry for all agents across servers. Display server, CLI, status, connected_at columns.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yue","title":"[Phase 3] Implement PEER_ROUTE handling","description":"Handle incoming PEER_ROUTE messages. Extract target agent, look up in local registry, deliver via existing tmux send-keys injection. Preserve automatic delivery magic.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yuf","title":"[Phase 3] Implement PEER_BROADCAST handling","description":"Handle incoming PEER_BROADCAST messages. Deliver to all local agents except excluded. Support scope (fleet vs server).","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yug","title":"[Phase 3] Integrate FederatedRouter with existing Router","description":"Modify existing Router to check FleetRegistry for remote agents. Route to PeerManager for cross-server delivery. Keep local delivery path unchanged.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T13:00:00Z"}
{"id":"agent-relay-yuh","title":"[Phase 3] Implement loop prevention","description":"Add hops array to PEER_ROUTE messages. Check for loops before forwarding. Drop messages that have already visited this server. Note: Can be implemented as part of fed-009/010.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T13:00:00Z"}
{"id":"agent-relay-yui","title":"[Phase 4] Implement reconnection logic","description":"Add exponential backoff reconnection (1sâ†’2sâ†’4sâ†’...â†’30s max). Unlimited retry attempts for configured peers. Resume session on reconnect.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yuj","title":"[Phase 4] Implement message queue for disconnected peers","description":"Create src/federation/message-queue.ts. Bounded queue per peer (max 1000 messages). TTL expiration (1 hour). Flush on reconnect.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T13:00:00Z"}
{"id":"agent-relay-yuk","title":"[Phase 4] Implement heartbeat (PING/PONG)","description":"Send PEER_PING every 30s. Expect PEER_PONG within 60s. Trigger reconnect on timeout. Track latency_ms in ServerRecord.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yul","title":"[Phase 4] Implement graceful shutdown (PEER_BYE)","description":"Send PEER_BYE on daemon shutdown. Remove agents from fleet registry. Allow queued messages to be sent before disconnect.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yum","title":"[Phase 4] CLI: agent-relay peer status","description":"Add peer subcommands: list, add, remove, status. Show connection state, latency, agent count, last seen.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yun","title":"[Phase 5] Add TLS support for peer connections","description":"Configure wss:// with cert/key/ca paths. Support mutual TLS (mTLS) optionally. Reject non-TLS in production mode.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T13:00:00Z"}
{"id":"agent-relay-yuo","title":"[Phase 5] Implement Ed25519 authentication","description":"Generate server keypair on first run. Challenge-response handshake. Sign all peer messages. Verify signatures on receive. See FEDERATION_PROPOSAL.md Section 8.1-8.3.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T13:00:00Z"}
{"id":"agent-relay-yup","title":"[Phase 5] Add configuration file support","description":"Parse /etc/agent-relay/config.yaml or ~/.agent-relay/config.yaml. Support all federation settings from FEDERATION_PROPOSAL.md Section 12. Environment variable overrides.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yuq","title":"[Phase 5] Update dashboard for fleet view","description":"Add fleet view toggle to dashboard. Show agents from all servers with server badge. Show peer connection status. Real-time updates via existing WebSocket.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-26T11:48:08.123881+01:00","closed_at":"2025-12-26T11:48:08.123881+01:00"}
{"id":"agent-relay-yur","title":"[Phase 5] Implement delivery confirmation","description":"Add DELIVERY_CONFIRMED message type. Detect injection via capture-pane. Send confirmation back to sender. Optional sender notification. See FEDERATION_PROPOSAL.md Section 7.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T13:00:00Z"}
{"id":"agent-relay-yus","title":"[Phase 5] Implement flow control","description":"Add credit-based flow control per peer. PEER_ACK to replenish credits. PEER_BUSY/PEER_READY for backpressure. Rate limiting. See FEDERATION_PROPOSAL.md Section 9.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T13:00:00Z"}
{"id":"agent-relay-yut","title":"[Storage] Implement trajectory storage adapter","description":"Create TrajectoryStorageAdapter interface. File system backend (default). SQLite backend for local queries. See FEDERATION_PROPOSAL.md Section 17 and Trajectories Proposal.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yuu","title":"[Storage] Implement central trajectory sync","description":"PostgreSQL backend for team sharing. Sync on task complete. Conflict resolution (server-wins default). See FEDERATION_PROPOSAL.md Section 17.3.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yuv","title":"[Transport] Implement NATS transport adapter","description":"Create NatsTransport implementing PeerTransport interface. JetStream for persistence. Subject-based routing. See FEDERATION_PROPOSAL.md Section 11.4.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T13:00:00Z"}
{"id":"agent-relay-yuw","title":"[Transport] Define PeerTransport interface","description":"Create src/federation/transport.ts with PeerTransport interface: connect(), disconnect(), send(), broadcast(), subscribe(), getConnectedPeers(). WebSocketTransport as default implementation. See FEDERATION_PROPOSAL.md Section 11.2.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T13:00:00Z","updated_at":"2025-12-21T13:00:00Z"}
{"id":"agent-relay-yux","title":"Write federation integration tests","description":"Docker Compose setup for multi-server testing. Test cross-server messaging, reconnection, broadcast. Chaos testing for network partitions.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T13:00:00Z"}
{"id":"agent-relay-yuy","title":"Write federation documentation","description":"Update README with federation quick start. Document configuration options. Add architecture diagrams. Troubleshooting guide.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T12:00:00Z","updated_at":"2025-12-21T12:00:00Z"}
{"id":"agent-relay-yuz","title":"[Hooks] Implement pattern namespace registry","description":"Create src/hooks/pattern-registry.ts. Register pattern handlers by namespace (@relay:, @memory:, @custom:). Match output against patterns. Route to handlers. Support built-in and user-defined namespaces. See HOOKS_API.md.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T16:00:00Z","updated_at":"2025-12-21T16:00:00Z"}
{"id":"agent-relay-yv0","title":"[Hooks] Implement hook lifecycle events","description":"Add lifecycle events to tmux wrapper: onSessionStart, onSessionEnd, onOutput, onIdle, onMessageReceived. Emit events with HookContext. Allow handlers to inject text. See HOOKS_API.md.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T16:00:00Z","updated_at":"2025-12-21T16:00:00Z"}
{"id":"agent-relay-yv1","title":"[Hooks] Implement @memory: built-in handler","description":"Create built-in @memory: pattern handler. Support actions: save, search, forget, list. Connect to Mem0 backend. Inject results back to agent. See HOOKS_API.md and MEMORY_STACK_DECISION.md.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T16:00:00Z","updated_at":"2025-12-21T16:00:00Z"}
{"id":"agent-relay-yv2","title":"[Hooks] Implement relay.config.ts loader","description":"Create config loader for relay.config.ts. Support project root and ~/.config/agent-relay/. Load pattern handlers and lifecycle hooks. Type-safe config with RelayConfig interface. See HOOKS_API.md.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T16:00:00Z","updated_at":"2025-12-21T16:00:00Z"}
{"id":"agent-relay-yv3","title":"[Hooks] Programmatic hook API","description":"Export Relay class with pattern() and on() methods. Allow programmatic registration of handlers. TypeScript types for HookContext, PatternHandler. See HOOKS_API.md.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T16:00:00Z","updated_at":"2025-12-21T16:00:00Z"}
{"id":"agent-relay-yv4","title":"[Hooks] Document hooks API with examples","description":"Write hooks documentation: pattern syntax, lifecycle events, config file format, programmatic API. Include examples for @memory:, @notify:, @deploy: patterns. Update README.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T16:00:00Z","updated_at":"2025-12-21T16:00:00Z"}
{"id":"agent-relay-yv5","title":"[Hooks] Create HookEmitter class","description":"Create src/hooks/emitter.ts with HookEmitter class. Support on(event, handler), emit(event, ...args). Handle async handlers. Support stop propagation. Load handlers from config object. See HOOKS_API.md.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T17:00:00Z","updated_at":"2025-12-21T17:00:00Z"}
{"id":"agent-relay-yv6","title":"[Hooks] Implement onSessionStart event","description":"Add onSessionStart hook to TmuxWrapper.start(). Fire after tmux spawn, before polling. Pass HookContext with agentId, sessionId, workingDir. Inject returned text. See HOOKS_API.md lifecycle spec.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T17:00:00Z","updated_at":"2025-12-21T17:00:00Z"}
{"id":"agent-relay-yv7","title":"[Hooks] Implement onSessionEnd event","description":"Add onSessionEnd hook to TmuxWrapper.stop() and SIGINT handler. Fire before cleanup. Inject returned text and wait for agent response (5s timeout). See HOOKS_API.md lifecycle spec.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T17:00:00Z","updated_at":"2025-12-21T17:00:00Z"}
{"id":"agent-relay-yv8","title":"[Hooks] Implement onOutput event","description":"Add onOutput hook to TmuxWrapper.pollOutput(). Fire on new output diff. Pass output string and context. Keep handlers fast (warn if \u003e100ms). See HOOKS_API.md lifecycle spec.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T17:00:00Z","updated_at":"2025-12-21T17:00:00Z"}
{"id":"agent-relay-yv9","title":"[Hooks] Implement onIdle event","description":"Add onIdle hook to TmuxWrapper.pollOutput(). Fire when no output for idleThreshold (default 30s). Fire once per idle period, not continuously. Configurable threshold. See HOOKS_API.md lifecycle spec.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T17:00:00Z","updated_at":"2025-12-21T17:00:00Z"}
{"id":"agent-relay-yva","title":"[Hooks] Implement onMessageReceived event","description":"Add onMessageReceived hook to TmuxWrapper.handleIncomingMessage(). Fire before injection. Allow suppress or custom inject. Pass RelayMessage and context. See HOOKS_API.md lifecycle spec.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T17:00:00Z","updated_at":"2025-12-21T17:00:00Z"}
{"id":"agent-relay-yvb","title":"[Hooks] Define HookContext and HookResult types","description":"Create src/hooks/types.ts with HookContext interface (agentId, sessionId, workingDir, env, inject(), send(), memory, relay, output[], messages[]). Define HookResult (inject?, suppress?, stop?). See HOOKS_API.md.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T17:00:00Z","updated_at":"2025-12-29T01:52:36.155592-05:00","closed_at":"2025-12-29T06:14:26.07552907Z"}
{"id":"agent-relay-yvc","title":"[Hooks] Implement hook sandboxing and limits","description":"Enforce hook restrictions: Object.freeze(ctx) for immutability, 2000 char inject limit, 5000 char message limit, one sendMessage per invocation. Add capability escalation config (allowNetworkInHooks, allowFileReadInHooks, unlimitedInjection). See HOOKS_API.md sandboxing section.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T18:00:00Z","updated_at":"2025-12-21T18:00:00Z"}
{"id":"agent-relay-yvd","title":"[Memory] Integrate Mem0 as memory substrate","description":"Add Mem0 dependency to agent-trajectories. Implement MemoryBackend interface wrapping Mem0 SDK. Support both self-hosted and cloud Mem0. See MEMORY_STACK_DECISION.md for architecture.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T15:00:00Z","updated_at":"2025-12-21T15:00:00Z"}
{"id":"agent-relay-yve","title":"[Memory] Configure Mem0 MCP for Claude Code agents","description":"Add MCP configuration for Mem0 integration with Claude Code. Document setup in agent-relay README. Test memory persistence across sessions.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T15:00:00Z","updated_at":"2025-12-21T15:00:00Z"}
{"id":"agent-relay-yvf","title":"[Memory] Build task-based trajectory layer on Mem0","description":"Implement trajectory grouping on top of Mem0 observations. Map task_id to Mem0 user_id or metadata. Support chapter-based organization within trajectories.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T15:00:00Z","updated_at":"2025-12-21T15:00:00Z"}
{"id":"agent-relay-yvg","title":"[Memory] Implement fleet-wide knowledge workspace","description":"Build knowledge workspace layer: decisions log, pattern library, cross-agent context. Query interface for agents to access fleet knowledge. Uses Mem0 for storage.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T15:00:00Z","updated_at":"2025-12-21T15:00:00Z"}
{"id":"agent-relay-yvh","title":"[Memory] Abstract MemoryBackend for future flexibility","description":"Create MemoryBackend interface allowing swap between Mem0, Zep, or custom SQLite+Chroma. Default to Mem0. Enable migration path if needs change.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T15:00:00Z","updated_at":"2025-12-21T15:00:00Z"}
{"id":"agent-relay-gst1","title":"[Dashboard] Add stuck agent detection","description":"Detect when an agent received a message but hasn't responded within a configurable threshold (default 5 min). Show 'stuck' indicator in dashboard UI. This is a communication-layer concern - helps surface when agents are blocked or crashed mid-response. Implementation: track lastMessageReceived and lastOutputTime per agent, compare in dashboard polling.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-02T12:00:00Z","updated_at":"2026-01-02T12:00:00Z","labels":["dashboard","monitoring","gastown-learnings"]}
{"id":"agent-relay-gst2","title":"[Dashboard] Show message delivery/ACK status","description":"Surface ACK status in dashboard message list. Currently ACKs exist in protocol but aren't visible to users. Show: pending (sent, no ACK), delivered (ACK received), failed (NACK or timeout). Helps debug 'did my message arrive?' issues. Implementation: track ACK state in router, expose via dashboard WebSocket.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-02T12:00:00Z","updated_at":"2026-01-02T12:00:00Z","labels":["dashboard","protocol","gastown-learnings"]}
{"id":"agent-relay-gst3","title":"[Research] Evaluate deeper Beads integration","description":"Research task: Evaluate how Agent Relay could integrate more deeply with Beads for task management. Questions to answer: (1) Should Relay auto-update Beads status when agents send DONE messages? (2) Can Relay read from Beads to show task context in dashboard? (3) What's the right boundary - Beads for work state, Relay for communication? Document findings in docs/BEADS_INTEGRATION.md.","status":"open","priority":3,"issue_type":"research","created_at":"2026-01-02T12:00:00Z","updated_at":"2026-01-02T12:00:00Z","labels":["research","beads","gastown-learnings"]}
{"id":"agent-relay-inj1","title":"[Core] Harden message injection with verification and retry","description":"## Summary\nMessage injection is core to Relay's real-time communication. Currently both TmuxWrapper and PtyWrapper inject messages blindly without verification. This bead adds injection confirmation, retry logic, and fallback mechanisms.\n\n## Current State\n\n### TmuxWrapper (interactive sessions)\n- Uses `tmux send-keys` for injection\n- Has idle detection (1.5s wait after output)\n- Has output stability check (pane content stops changing)\n- Has cursor position check (prompt detection)\n- Has bracketed paste to prevent interleaving\n- **Missing**: No verification that message appeared in scrollback\n- **Missing**: No retry on failure\n\n### PtyWrapper (spawned workers)\n- Uses `ptyProcess.write()` for direct injection\n- Has message queue with sequential processing\n- Has 500ms delay between messages\n- **Missing**: No idle detection (just blindly writes)\n- **Missing**: No verification\n- **Missing**: No retry logic\n\n## Implementation Plan\n\n### Phase 1: Injection Verification\n\n**TmuxWrapper changes:**\n```typescript\nprivate async verifyInjection(msg: QueuedMessage): Promise<boolean> {\n  // Wait for injection to settle\n  await this.sleep(200);\n  \n  // Capture pane content\n  const paneContent = await this.capturePane();\n  \n  // Check if our message appears in recent output\n  // Look for 'Relay message from {from} [{shortId}]'\n  const expectedPattern = `Relay message from ${msg.from} [${msg.messageId.substring(0, 8)}]`;\n  return paneContent.includes(expectedPattern);\n}\n```\n\n**PtyWrapper changes:**\n```typescript\nprivate async verifyInjection(msg: QueuedMessage): Promise<boolean> {\n  // Wait for output to include our message\n  const startTime = Date.now();\n  const timeout = 2000;\n  const expectedPattern = `Relay message from ${msg.from} [${msg.messageId.substring(0, 8)}]`;\n  \n  while (Date.now() - startTime < timeout) {\n    if (this.rawBuffer.includes(expectedPattern)) {\n      return true;\n    }\n    await this.sleep(100);\n  }\n  return false;\n}\n```\n\n### Phase 2: Retry with Backoff\n\n```typescript\nprivate async injectWithRetry(\n  msg: QueuedMessage,\n  maxRetries: number = 3\n): Promise<InjectionResult> {\n  for (let attempt = 0; attempt < maxRetries; attempt++) {\n    // Inject the message\n    await this.performInjection(msg);\n    \n    // Verify it landed\n    if (await this.verifyInjection(msg)) {\n      return { success: true, attempts: attempt + 1 };\n    }\n    \n    // Log retry attempt\n    this.logStderr(`Injection not verified, retry ${attempt + 1}/${maxRetries}`);\n    \n    // Backoff before retry\n    await this.sleep(500 * (attempt + 1));\n  }\n  \n  // All retries failed\n  return { success: false, attempts: maxRetries };\n}\n```\n\n### Phase 3: Fallback to Inbox\n\nIf injection fails after retries, write to file inbox as durable fallback:\n\n```typescript\nprivate async injectNextMessage(): Promise<void> {\n  const msg = this.messageQueue.shift();\n  if (!msg) return;\n  \n  const result = await this.injectWithRetry(msg);\n  \n  if (!result.success) {\n    // Fallback: write to inbox file\n    this.inbox?.addMessage(msg.from, msg.body);\n    this.logStderr(`Injection failed after ${result.attempts} attempts, wrote to inbox`);\n    \n    // Emit event for dashboard to show warning\n    this.emit('injection-failed', {\n      messageId: msg.messageId,\n      from: msg.from,\n      fallback: 'inbox'\n    });\n  }\n}\n```\n\n### Phase 4: PtyWrapper Idle Detection\n\nAdd output stability check to PtyWrapper (currently missing):\n\n```typescript\nprivate async waitForOutputStable(timeoutMs: number = 2000): Promise<boolean> {\n  const pollInterval = 200;\n  const requiredStablePolls = 2;\n  let lastLength = this.rawBuffer.length;\n  let stableCount = 0;\n  const startTime = Date.now();\n  \n  while (Date.now() - startTime < timeoutMs) {\n    await this.sleep(pollInterval);\n    \n    if (this.rawBuffer.length === lastLength) {\n      stableCount++;\n      if (stableCount >= requiredStablePolls) {\n        return true;\n      }\n    } else {\n      stableCount = 0;\n      lastLength = this.rawBuffer.length;\n    }\n  }\n  \n  return false;\n}\n\nprivate async processMessageQueue(): Promise<void> {\n  // ... existing checks ...\n  \n  // NEW: Wait for output to stabilize before injecting\n  const stable = await this.waitForOutputStable();\n  if (!stable) {\n    // Re-queue message and try later\n    this.messageQueue.unshift(msg);\n    setTimeout(() => this.processMessageQueue(), 500);\n    return;\n  }\n  \n  // Proceed with injection\n  // ...\n}\n```\n\n### Phase 5: Health Check Before Injection\n\n**TmuxWrapper:**\n```typescript\nprivate async isAgentAlive(): Promise<boolean> {\n  // Check if tmux session still exists\n  try {\n    await execAsync(`tmux has-session -t ${this.sessionName}`);\n    return true;\n  } catch {\n    return false;\n  }\n}\n```\n\n**PtyWrapper:**\n```typescript\nprivate isAgentAlive(): boolean {\n  return this.running && this.ptyProcess !== undefined;\n}\n```\n\n### Phase 6: Dashboard Integration\n\nSurface injection status in dashboard:\n\n1. Add `injection_status` field to message records: `pending`, `delivered`, `failed`\n2. Show visual indicator in message list (green check, yellow pending, red X)\n3. Add alert for failed injections\n4. Show retry count in message details\n\n### Phase 7: Metrics & Observability\n\nAdd metrics for monitoring injection reliability:\n\n```typescript\ninterface InjectionMetrics {\n  total_injections: number;\n  successful_first_try: number;\n  successful_with_retry: number;\n  failed_to_inbox: number;\n  average_retry_count: number;\n}\n```\n\nExpose via `/metrics` endpoint for Prometheus scraping.\n\n## Files to Modify\n\n1. `src/wrapper/tmux-wrapper.ts` - Add verification, retry, fallback\n2. `src/wrapper/pty-wrapper.ts` - Add idle detection, verification, retry, fallback\n3. `src/wrapper/inbox.ts` - Ensure atomic writes, add message ID tracking\n4. `src/dashboard-server/server.ts` - Add injection status to WebSocket updates\n5. `src/storage/adapter.ts` - Add injection_status field to message schema\n6. `src/dashboard/` - UI for injection status indicators\n\n## Testing Plan\n\n1. Unit tests for verification logic\n2. Integration test: inject during active output, verify retry works\n3. Integration test: inject to dead session, verify fallback to inbox\n4. Load test: rapid message injection, measure success rate\n5. Manual test: kill agent mid-injection, verify graceful handling\n\n## Success Criteria\n\n- Injection success rate > 99% under normal conditions\n- Failed injections always fall back to inbox (no message loss)\n- Dashboard shows clear status for all message deliveries\n- Metrics available for monitoring injection health","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-02T13:00:00Z","updated_at":"2026-01-02T13:00:00Z","labels":["core","reliability","injection","tmux","node-pty","gastown-learnings"]}
{"id":"agent-relay-wrap1","title":"[Arch] Extract BaseWrapper abstract class for TmuxWrapper and PtyWrapper","description":"## Summary\nExtract common functionality between TmuxWrapper and PtyWrapper into an abstract base class to:\n1. Ensure feature parity between the two implementations\n2. Make adding new features easier (add once in base, implement specifics in subclasses)\n3. Prevent divergence over time\n4. Reduce code duplication\n\n## Current State Analysis\n\n### Common Code (should be in base class):\n- `RelayClient` initialization and lifecycle\n- `messageQueue` management (same structure in both)\n- `isInjecting` state flag\n- `sentMessageHashes: Set<string>` for deduplication\n- `processedSpawnCommands` and `processedReleaseCommands` Sets\n- `stripAnsi()` method (nearly identical implementations)\n- `sleep()` helper (identical)\n- `sendRelayCommand()` method (similar pattern)\n- `handleIncomingMessage()` signature and queue push\n- Injection string format: `Relay message from ${from} [${shortId}]${hints}: ${body}`\n- Thread/importance/channel hint building\n- Spawn/release command parsing\n- `relayPrefix` handling\n\n### Diverged Code (TmuxWrapper has, PtyWrapper missing):\n- Storage integration (SQLite for summaries)\n- Activity state tracking (active/idle/disconnected)\n- Summary parsing (`[[SUMMARY]]` blocks)\n- Session end handling (`[[SESSION_END]]` blocks)\n- Sophisticated input clearing (cursor stability check)\n- Bracketed paste for safer injection\n- Continuation line joining for TUI output\n\n### Diverged Code (PtyWrapper has, TmuxWrapper missing):\n- EventEmitter extension (TmuxWrapper should also emit events)\n- `injection-failed` event emission\n- `getInjectionMetrics()` method\n- `pendingMessageCount` getter\n- Auto-accept prompts for Claude --dangerously-skip-permissions\n- Terminal escape sequence handling\n- Log file streaming to disk\n\n## Proposed Interface\n\n```typescript\nabstract class BaseWrapper extends EventEmitter {\n  // Common state\n  protected config: WrapperConfig;\n  protected client: RelayClient;\n  protected running = false;\n  protected messageQueue: QueuedMessage[] = [];\n  protected isInjecting = false;\n  protected readyForMessages = false;\n  protected sentMessageHashes = new Set<string>();\n  protected processedSpawnCommands = new Set<string>();\n  protected processedReleaseCommands = new Set<string>();\n  protected relayPrefix: string;\n  protected lastOutputTime = 0;\n  protected injectionMetrics = {...};\n\n  // Abstract methods (subclasses must implement)\n  abstract start(): Promise<void>;\n  abstract stop(): void;\n  protected abstract performInjection(message: string): Promise<void>;\n  protected abstract verifyInjection(shortId: string, from: string): Promise<boolean>;\n  protected abstract getRawOutput(): string;\n  protected abstract isAgentAlive(): boolean;\n\n  // Common implementations\n  protected stripAnsi(str: string): string;\n  protected sleep(ms: number): Promise<void>;\n  protected buildInjectionString(msg: QueuedMessage): string;\n  protected sendRelayCommand(cmd: ParsedCommand): void;\n  protected handleIncomingMessage(...): void;\n  protected async processMessageQueue(): Promise<void>;\n  protected async injectWithRetry(...): Promise<InjectionResult>;\n  protected async waitForOutputStable(): Promise<boolean>;\n  protected parseSpawnReleaseCommands(content: string): void;\n\n  // Common getters\n  get isRunning(): boolean;\n  get name(): string;\n  getInjectionMetrics(): InjectionMetrics;\n  get pendingMessageCount(): number;\n}\n```\n\n## Implementation Plan\n\n### Phase 1: Create base class (src/wrapper/base-wrapper.ts)\n1. Create BaseWrapper abstract class with EventEmitter extension\n2. Move common types: QueuedMessage, InjectionResult, InjectionMetrics\n3. Implement common methods: stripAnsi, sleep, buildInjectionString\n4. Implement message queue processing with injection retry\n5. Implement spawn/release parsing\n\n### Phase 2: Refactor PtyWrapper to extend BaseWrapper\n1. Remove duplicated code\n2. Implement abstract methods: performInjection, verifyInjection, getRawOutput\n3. Keep PTY-specific code: node-pty integration, log files, auto-accept\n\n### Phase 3: Refactor TmuxWrapper to extend BaseWrapper\n1. Add EventEmitter extension (via base class)\n2. Remove duplicated code\n3. Implement abstract methods\n4. Keep tmux-specific code: session management, attach, capture-pane\n\n### Phase 4: Port missing features\n1. Add injection metrics to TmuxWrapper (inherit from base)\n2. Add `injection-failed` event to TmuxWrapper\n\n### Phase 5: Add shared tests\n1. Create base-wrapper.test.ts with common behavior tests\n2. Test injection retry logic\n3. Test message queue processing\n\n## Files to Create/Modify\n- `src/wrapper/base-wrapper.ts` (NEW)\n- `src/wrapper/pty-wrapper.ts` (MODIFY - extend base)\n- `src/wrapper/tmux-wrapper.ts` (MODIFY - extend base)\n- `src/wrapper/types.ts` (NEW - shared types)\n- `src/wrapper/base-wrapper.test.ts` (NEW)\n\n## Success Criteria\n- Both wrappers extend BaseWrapper\n- All common code lives in base class\n- Adding injection improvements updates both wrappers\n- Injection metrics available in both wrappers\n- No breaking changes to external API\n- All existing tests pass","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T15:00:00Z","updated_at":"2026-01-02T15:00:00Z","labels":["architecture","refactor","wrapper","parity"]}
{"id": "agent-relay-cloud1", "title": "[Cloud] Implement durable persistence via PtyWrapper events", "description": "## Summary\n\nPtyWrapper now emits 'summary' and 'session-end' events when agents output [[SUMMARY]] and [[SESSION_END]] blocks. Cloud services should implement persistence handlers for these events using durable storage (PostgreSQL, Redis) instead of SQLite.\n\n## Current State\n\n- TmuxWrapper has SQLite storage integration for summaries and session state\n- PtyWrapper now emits events but has no storage (by design - cloud handles it)\n- Cloud deployments use PtyWrapper exclusively (no tmux)\n\n## Event Interface\n\n```typescript\ninterface SummaryEvent {\n  agentName: string;\n  summary: ParsedSummary; // currentTask, completedTasks, decisions, context, files\n}\n\ninterface SessionEndEvent {\n  agentName: string;\n  marker: SessionEndMarker; // summary, completedTasks\n}\n\n// PtyWrapperEvents emits:\n// - 'summary': (event: SummaryEvent) => void\n// - 'session-end': (event: SessionEndEvent) => void\n```\n\n## Implementation Requirements\n\n### Cloud Persistence Service\n\n```typescript\nclass CloudPersistenceService {\n  constructor(\n    private db: PostgresClient | RedisClient,\n    private sessionId: string\n  ) {}\n\n  bindToPtyWrapper(wrapper: PtyWrapper): void {\n    wrapper.on('summary', (event) => this.handleSummary(event));\n    wrapper.on('session-end', (event) => this.handleSessionEnd(event));\n  }\n\n  private async handleSummary(event: SummaryEvent): Promise<void> {\n    await this.db.query(`\n      INSERT INTO agent_summaries (session_id, agent_name, summary, created_at)\n      VALUES ($1, $2, $3, NOW())\n      ON CONFLICT (session_id, agent_name) \n      DO UPDATE SET summary = $3, updated_at = NOW()\n    `, [this.sessionId, event.agentName, JSON.stringify(event.summary)]);\n  }\n\n  private async handleSessionEnd(event: SessionEndEvent): Promise<void> {\n    await this.db.query(`\n      UPDATE sessions SET ended_at = NOW(), end_marker = $2 WHERE id = $1\n    `, [this.sessionId, JSON.stringify(event.marker)]);\n    \n    // Clean up resources\n    await this.cleanupSession(this.sessionId);\n  }\n}\n```\n\n### PostgreSQL Schema\n\n```sql\nCREATE TABLE agent_summaries (\n  id SERIAL PRIMARY KEY,\n  session_id UUID NOT NULL REFERENCES sessions(id),\n  agent_name VARCHAR(255) NOT NULL,\n  summary JSONB NOT NULL,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  updated_at TIMESTAMPTZ DEFAULT NOW(),\n  UNIQUE(session_id, agent_name)\n);\n\nCREATE TABLE sessions (\n  id UUID PRIMARY KEY,\n  user_id UUID NOT NULL,\n  started_at TIMESTAMPTZ DEFAULT NOW(),\n  ended_at TIMESTAMPTZ,\n  end_marker JSONB\n);\n\nCREATE INDEX idx_summaries_session ON agent_summaries(session_id);\n```\n\n### Redis Alternative\n\nFor high-frequency summary updates:\n\n```typescript\n// Store latest summary per agent\nawait redis.hset(`session:${sessionId}:summaries`, agentName, JSON.stringify(summary));\n\n// TTL for automatic cleanup\nawait redis.expire(`session:${sessionId}:summaries`, 86400); // 24h\n```\n\n## Files to Create\n\n1. `src/cloud/persistence-service.ts` - Event handler for cloud persistence\n2. `src/cloud/schema.sql` - PostgreSQL schema for cloud deployment\n3. `src/cloud/index.ts` - Cloud service initialization\n\n## Testing\n\n1. Unit test: SummaryEvent emitted when [[SUMMARY]] detected\n2. Unit test: SessionEndEvent emitted when [[SESSION_END]] detected  \n3. Unit test: Deduplication works (same summary not emitted twice)\n4. Integration: PostgreSQL persistence handler\n5. Integration: Full session lifecycle with events\n\n## Success Criteria\n\n- Cloud services can persist summaries to PostgreSQL/Redis\n- No SQLite dependency in cloud deployments\n- Event-based architecture allows flexible storage backends\n- Session cleanup triggered by session-end events", "status": "closed", "priority": 2, "issue_type": "feature", "created_at": "2026-01-02T16:00:00Z", "updated_at": "2026-01-02T16:00:00Z", "labels": ["cloud", "persistence", "events", "postgresql", "redis"], "closed_at": "2026-01-02T12:00:00Z", "close_reason": "Implemented: CloudPersistenceService, migrations 0002_agent_sessions.sql, query helpers in drizzle.ts"}
